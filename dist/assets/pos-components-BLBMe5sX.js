import{u as ue,a as J,F as Q,r as d,j as e,T as le,I as X,b as H,K as ce,Q as oe,B as re,d as ee,y as xe,D as ae,S as he,s as K,v as Me,f as se,J as Be,E as te,R as me,C as Z,e as Ne,l as Re,U as fe,A as Pe,G as Ge}from"./react-core-i1FDzZHP.js";import{f as Ie,I as C,E as Ke,A as D,a as de,b as Ve,c as We,L as Ye,d as Je,P as Xe,u as Ze,e as He,g as es,h as ss,i as ts,j as as,k as rs,l as ls,m as cs,r as ke,n as ns}from"./index-B2KmX_8V.js";const{Title:Te,Text:V}=le,{Option:is}=ce,{TextArea:ds}=X,{Search:os}=X;function xs({open:S,onClose:m}){const l=ue(),M=J(t=>t.rawMaterials.rawMaterialsList),[x]=Q.useForm(),[R]=Q.useForm(),[g,N]=d.useState(!1),[w,y]=d.useState([]),[A,h]=d.useState(0),[v,I]=d.useState("Custom Product"),[c,z]=d.useState(""),[P,E]=d.useState(0),[U,q]=d.useState(0),[$,n]=d.useState("");d.useEffect(()=>{S&&(l(Ie()),x.resetFields(),y([]),h(0),q(0),I("Custom Product"),z(""),E(0),n(""))},[S,l,x]),d.useEffect(()=>{const t=w.reduce((f,L)=>f+L.quantity*L.unitPrice,0);h(t),q(t)},[w]);const j=(M||[]).filter(t=>t.name.toLowerCase().includes($.toLowerCase())||t.category.toLowerCase().includes($.toLowerCase())),u=t=>{const f=(M||[]).find(p=>p.id===t.materialId);if(!f){K.error("Material not found");return}const L=w.find(p=>p.id===t.materialId);y(L?w.map(p=>p.id===t.materialId?{...p,quantity:p.quantity+t.quantity}:p):[...w,{id:f.id,name:f.name,unit:f.unit,quantity:t.quantity,unitPrice:f.unitPrice,totalPrice:t.quantity*f.unitPrice}]),R.resetFields(["materialId","quantity"])},O=t=>{y(w.filter(f=>f.id!==t))},r=()=>{if(P===0&&!v.trim()){K.error("Please enter a name for the custom product");return}E(P+1)},s=()=>{E(P-1)},o=()=>{if(w.length===0){K.error("Please add at least one material");return}if(!v.trim()){K.error("Please enter a name for the custom product");return}try{N(!0);const t={id:`CUSTOM-${Date.now()}`,name:v,description:c||"Custom product",price:U,category:"Custom",stock:999,barcode:`CUSTOM-${Date.now()}`,rawMaterials:w.map(f=>({rawMaterialId:f.id,quantity:f.quantity})),isCustom:!0};l(de({product:t})),K.success("Custom product added to cart"),m()}catch{K.error("Failed to create custom product")}finally{N(!1)}},T=[{title:"Product Info",description:"Basic details",icon:"info",content:e.jsxs("div",{className:"space-y-4",children:[e.jsx(Te,{level:5,children:"Custom Product Information"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:e.jsxs("div",{children:[e.jsx(V,{strong:!0,children:"Name:"}),e.jsx(X,{placeholder:"Enter custom product name",value:v,onChange:t=>I(t.target.value),className:"mt-1",size:"large"})]})}),e.jsxs("div",{children:[e.jsx(V,{strong:!0,children:"Description:"}),e.jsx(ds,{placeholder:"Enter description (optional)",value:c,onChange:t=>z(t.target.value),rows:2,className:"mt-1"})]})]})},{title:"Add Materials",description:"Select materials",icon:"category",content:e.jsxs("div",{className:"space-y-4",children:[e.jsx(Te,{level:5,children:"Add Raw Materials"}),e.jsx(os,{placeholder:"Search materials...",onChange:t=>n(t.target.value),className:"mb-4"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3 mb-4",children:j.map(t=>e.jsx(H,{size:"small",className:"cursor-pointer hover:shadow-md transition-shadow",onClick:()=>{R.setFieldsValue({materialId:t.id,quantity:1})},children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center",children:e.jsx(C,{name:"category",className:"text-blue-600"})}),e.jsxs("div",{children:[e.jsx(V,{strong:!0,className:"block",children:t.name}),e.jsxs(V,{type:"secondary",className:"text-xs",children:["LKR ",t.unitPrice.toFixed(2)," per ",t.unit]}),e.jsx("br",{}),e.jsxs(V,{type:"secondary",className:"text-xs",children:["Stock: ",t.stockQuantity," ",t.unit]})]})]})},t.id))}),e.jsx(Q,{form:R,layout:"horizontal",onFinish:u,children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx(Q.Item,{name:"materialId",rules:[{required:!0,message:"Please select a material"}],className:"flex-1",children:e.jsx(ce,{placeholder:"Select material",showSearch:!0,optionFilterProp:"children",filterOption:(t,f)=>f.children.toLowerCase().indexOf(t.toLowerCase())>=0,children:(M||[]).map(t=>e.jsxs(is,{value:t.id,children:[t.name," (LKR ",t.unitPrice,"/",t.unit,") - Stock: ",t.stockQuantity]},t.id))})}),e.jsx(Q.Item,{name:"quantity",rules:[{required:!0,message:"Please enter quantity"}],className:"w-24",children:e.jsx(oe,{min:.1,step:.1,placeholder:"Qty",className:"w-full"})}),e.jsx(Q.Item,{className:"w-20",children:e.jsx(re,{type:"primary",htmlType:"submit",icon:e.jsx(C,{name:"add"}),block:!0,children:"Add"})})]})}),e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx(V,{strong:!0,children:"Selected Materials"}),e.jsxs(V,{strong:!0,children:["Total: LKR ",A.toFixed(2)]})]}),w.length===0?e.jsxs("div",{className:"text-center py-4",children:[e.jsx(C,{name:"category",className:"text-gray-300 text-2xl mb-2"}),e.jsx(V,{type:"secondary",children:"No materials added yet"})]}):e.jsx(ee,{dataSource:w,renderItem:t=>e.jsxs(ee.Item,{className:"flex justify-between items-center",actions:[e.jsx(re,{type:"text",danger:!0,icon:e.jsx(C,{name:"delete"}),onClick:()=>O(t.id)})],children:[e.jsxs("div",{children:[e.jsx(V,{children:t.name}),e.jsx("div",{children:e.jsxs(V,{type:"secondary",className:"text-sm",children:[t.quantity," ",t.unit," × LKR ",t.unitPrice.toFixed(2)]})})]}),e.jsxs(V,{strong:!0,children:["LKR ",(t.quantity*t.unitPrice).toFixed(2)]})]},t.id)})]}),e.jsxs("div",{className:"flex gap-2 justify-between",children:[e.jsx(V,{strong:!0,children:"Price:"}),e.jsx(oe,{className:"w-44 mt-1",min:.01,value:U,onChange:t=>q(t),formatter:t=>`LKR ${t}`.replace(/\B(?=(\d{3})+(?!\d))/g,","),parser:t=>t.replace(/LKR\s?|(,*)/g,""),step:100,size:"large"}),A>0&&e.jsxs(V,{type:"secondary",className:"text-xs block mt-1",children:["Suggested price: LKR ",(A*1.5).toFixed(2)," (based on materials with 50% markup)"]})]})]})}];return e.jsx(xe,{title:e.jsxs(he,{children:[e.jsx(C,{name:"build",className:"text-blue-600"}),e.jsx("span",{children:"Create Custom Product"})]}),open:S,onCancel:m,width:800,footer:null,destroyOnClose:!0,children:e.jsxs("div",{className:"space-y-6",children:[e.jsx(Ke,{current:P,steps:T}),e.jsx("div",{className:"min-h-[400px] mt-6",children:T[P].content}),e.jsx(ae,{}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("div",{children:P>0&&e.jsxs(D,{onClick:s,children:[e.jsx(C,{name:"arrow_back",className:"mr-2"}),"Previous"]})}),e.jsxs("div",{className:"space-x-2",children:[e.jsx(D,{onClick:m,children:"Cancel"}),P<T.length-1?e.jsxs(D.Primary,{onClick:r,children:["Next",e.jsx(C,{name:"arrow_forward",className:"ml-2"})]}):e.jsx(D.Primary,{onClick:o,loading:g,disabled:w.length===0||!v.trim(),icon:"add_shopping_cart",children:"Add to Cart"})]})]})]})})}const{Title:Ae,Text:F}=le,{Search:ms}=X;function us({open:S,onClose:m,product:l}){const M=ue(),x=J(n=>n.rawMaterials.rawMaterialsList),[R,g]=d.useState(!1),[N,w]=d.useState(0),[y,A]=d.useState([]),[h,v]=d.useState(1),[I,c]=d.useState(0),[z,P]=d.useState(""),E=(x||[]).filter(n=>l?.addons?.some(j=>j.id===n.id)&&n.stockQuantity>0&&n.name.toLowerCase().includes(z.toLowerCase()));d.useEffect(()=>{S&&(M(Ie()),A([]),v(1),P(""))},[S,l,M]),d.useEffect(()=>{if(!l)return;const n=l.price,j=y.reduce((O,r)=>{const s=(x||[]).find(o=>o.id===r.id);return O+(s?s.unitPrice*r.quantity:0)},0),u=(n+j)*h;c(u),w(n*h)},[y,h,l,x]);const U=(n,j)=>{j?(x||[]).find(O=>O.id===n)&&A([...y,{id:n,quantity:1}]):A(y.filter(u=>u.id!==n))},q=(n,j)=>{A(y.map(u=>u.id===n?{...u,quantity:j}:u))},$=()=>{if(l)try{g(!0);const n={...l,addons:y.map(j=>{const u=x.find(O=>O.id===j.id);return{id:j.id,name:u.name,quantity:j.quantity,price:u.unitPrice*j.quantity}}),price:N/h,selectedVariant:l.selectedVariant,selectedSize:l.selectedSize};M(de({product:n,quantity:h})),K.success("Product added to cart with addons"),m()}catch{K.error("Failed to add product to cart")}finally{g(!1)}};return l?e.jsx(xe,{title:e.jsxs(he,{children:[e.jsx(C,{name:"add_circle",className:"text-blue-600"}),e.jsxs("span",{children:["Add ",l.name," with Addons"]})]}),open:S,onCancel:m,width:800,footer:null,destroyOnClose:!0,children:e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"bg-blue-50 p-4 rounded-lg",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx(Me,{src:l.image||"https://images.pexels.com/photos/586344/pexels-photo-586344.jpeg?auto=compress&cs=tinysrgb&w=300",alt:l.name,width:80,height:80,className:"object-cover rounded",preview:!1,style:{aspectRatio:"1/1",objectFit:"cover"}}),e.jsxs("div",{children:[e.jsx(F,{strong:!0,className:"text-lg",children:l.name}),e.jsx("div",{children:e.jsx(F,{type:"secondary",children:l.description})}),e.jsxs("div",{className:"mt-1",children:[e.jsx(se,{color:"blue",children:l.category}),e.jsxs(se,{color:l.stock>10?"green":l.stock>0?"orange":"red",children:[l.stock," in stock"]})]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs(F,{strong:!0,className:"text-xl text-blue-600",children:["LKR ",(l.price||0).toFixed(2)]}),e.jsxs("div",{className:"mt-2",children:[e.jsx(F,{strong:!0,children:"Quantity: "}),e.jsx(oe,{min:1,max:l.stock||1,value:h,onChange:v,className:"ml-2",step:1})]})]})]})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx(Ae,{level:5,children:"Available Addons"}),e.jsx(ms,{placeholder:"Search addons...",onChange:n=>P(n.target.value),className:"w-64",allowClear:!0})]}),E.length===0?e.jsxs("div",{className:"text-center py-4 bg-gray-50 rounded-lg",children:[e.jsx(C,{name:"category",className:"text-gray-300 text-2xl mb-2"}),e.jsx(F,{type:"secondary",children:"No addons available"})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:E.map(n=>{const j=y.some(u=>u.id===n.id);return e.jsx(H,{size:"small",className:`cursor-pointer transition-all ${j?"border-blue-500 bg-blue-50":"hover:border-blue-300"}`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(Be,{checked:j,onChange:u=>U(n.id,u.target.checked),className:"mr-3"}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center",children:e.jsx(C,{name:"category",className:"text-blue-600"})}),e.jsxs("div",{children:[e.jsx(F,{strong:!0,children:n.name}),e.jsx("div",{children:e.jsxs(F,{type:"secondary",className:"text-sm",children:["LKR ",n.unitPrice.toFixed(2)," per ",n.unit]})})]})]})]}),j&&e.jsxs("div",{children:[e.jsx(oe,{min:1,max:n.stockQuantity,value:y.find(u=>u.id===n.id)?.quantity||1,onChange:u=>q(n.id,u),size:"small",className:"w-16",step:1,onClick:u=>u.stopPropagation()}),e.jsx(F,{className:"ml-2",children:n.unit})]})]})},n.id)})})]}),y.length>0&&e.jsxs("div",{className:"border rounded-lg p-4",children:[e.jsx(Ae,{level:5,children:"Selected Addons"}),e.jsx(ee,{dataSource:y,renderItem:n=>{const j=(x||[]).find(u=>u.id===n.id);return j?e.jsxs(ee.Item,{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx(F,{strong:!0,children:j.name}),e.jsx("div",{children:e.jsxs(F,{type:"secondary",className:"text-sm",children:[n.quantity," ",j.unit," × LKR ",j.unitPrice.toFixed(2)]})})]}),e.jsxs(F,{strong:!0,children:["LKR ",(j.unitPrice*n.quantity).toFixed(2)]})]},n.id):null}})]}),e.jsx("div",{className:"bg-gray-50 p-4 rounded-lg",children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx(F,{children:"Base Price:"}),e.jsxs(F,{children:["LKR ",(l.price||0).toFixed(2)," × ",h]})]}),y.length>0&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx(F,{children:"Addons:"}),e.jsxs(F,{children:["LKR ",y.reduce((n,j)=>{const u=(x||[]).find(O=>O.id===j.id);return n+(u?u.unitPrice*j.quantity:0)},0).toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx(F,{children:"Quantity:"}),e.jsxs(F,{children:["× ",h]})]})]}),e.jsxs(F,{type:"secondary",className:"text-xs block",children:["Suggested price: LKR ",I.toFixed(2)," (calculated from base price and addons)"]}),e.jsx(ae,{className:"my-2"}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx(F,{strong:!0,children:"Total:"}),e.jsxs(F,{strong:!0,className:"text-blue-600 text-lg",children:["LKR ",I.toFixed(2)]})]})]})}),e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx(D,{onClick:m,children:"Cancel"}),e.jsx(D.Primary,{onClick:$,loading:R,icon:"add_shopping_cart",children:"Add to Cart"})]})]})}):null}const{Text:_,Title:ge}=le;function hs({open:S,onClose:m,product:l,onColorAndSizeSelected:M}){const[x,R]=d.useState(null),[g,N]=d.useState(null);if(d.useEffect(()=>{S&&l&&(R(null),N(null))},[S,l]),!l)return null;const w=l.colors||[],y=c=>{R(c),N(null)},A=c=>{N(c)},h=()=>{!x||!g||M(x,g)},v=()=>x?x.sizes||[]:[],I=c=>c.sizes?c.sizes.reduce((z,P)=>z+(P.stock||0),0):0;return e.jsx(xe,{title:e.jsxs(he,{children:[e.jsx(C,{name:"palette",className:"text-blue-600"}),e.jsxs("span",{children:["Select Color and Size for ",l.name]})]}),open:S,onCancel:m,width:900,footer:[e.jsx(re,{onClick:m,children:"Cancel"},"cancel"),e.jsx(re,{type:"primary",disabled:!x||!g,onClick:h,icon:e.jsx(C,{name:"add_shopping_cart"}),children:x?g?`Add to Cart - LKR ${(l.price||0).toFixed(2)}`:"Select a Size":"Select a Color"},"add")],children:e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"bg-blue-50 p-4 rounded-lg",children:e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx(Me,{src:l.image||"https://images.pexels.com/photos/586344/pexels-photo-586344.jpeg?auto=compress&cs=tinysrgb&w=300",alt:l.name,width:80,height:80,className:"object-cover rounded",preview:!1,style:{aspectRatio:"1/1",objectFit:"cover"}}),e.jsxs("div",{className:"flex-1",children:[e.jsx(ge,{level:4,className:"mb-1",children:l.name}),e.jsx(_,{type:"secondary",children:l.description}),e.jsxs("div",{className:"mt-2",children:[e.jsx(se,{color:"blue",children:l.category}),e.jsxs(_,{strong:!0,className:"text-xl text-blue-600 ml-4",children:["LKR ",(l.price||0).toFixed(2)]})]})]})]})}),e.jsxs("div",{children:[e.jsx(ge,{level:5,className:"mb-4",children:"Step 1: Select Color"}),w.length===0?e.jsx(te,{description:"No colors available for this product"}):e.jsx(me,{gutter:[16,16],children:w.map(c=>e.jsx(Z,{xs:24,sm:12,md:8,lg:6,children:e.jsx(H,{hoverable:!0,className:`cursor-pointer transition-all ${x?.id===c.id?"border-blue-500 shadow-md bg-blue-50":""}`,onClick:()=>y(c),bodyStyle:{padding:"16px"},children:e.jsxs("div",{className:"text-center space-y-3",children:[e.jsx("div",{className:"flex justify-center",children:e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"w-12 h-12 rounded-full border-2 border-gray-300 overflow-hidden",style:{backgroundImage:c.image?`url(${c.image})`:"none",backgroundSize:"cover",backgroundPosition:"center",backgroundColor:c.colorCode||"#f0f0f0"},children:!c.image&&e.jsx("div",{className:"w-full h-full flex items-center justify-center",children:e.jsx(C,{name:"palette",className:"text-gray-400"})})}),x?.id===c.id&&e.jsx("div",{className:"absolute -top-1 -right-1 w-6 h-6 bg-blue-600 rounded-full flex items-center justify-center",children:e.jsx(C,{name:"check",className:"text-white text-sm"})})]})}),e.jsxs("div",{children:[e.jsx(_,{strong:!0,className:"block",children:c.name}),e.jsx(Ne,{count:I(c),showZero:!0,style:{backgroundColor:I(c)>0?"#52c41a":"#ff4d4f"}}),e.jsxs(_,{type:"secondary",className:"text-xs block mt-1",children:[c.sizes?.length||0," size",(c.sizes?.length||0)!==1?"s":""," available"]})]})]})})},c.id))})]}),x&&e.jsxs("div",{children:[e.jsxs(ge,{level:5,className:"mb-4",children:["Step 2: Select Size for ",x.name]}),v().length===0?e.jsx(te,{description:"No sizes available for this color"}):e.jsx(me,{gutter:[16,16],children:v().map(c=>e.jsx(Z,{xs:24,sm:12,md:8,lg:6,children:e.jsx(H,{hoverable:!0,className:`cursor-pointer transition-all ${g?.id===c.id?"border-blue-500 shadow-md bg-blue-50":""}`,onClick:()=>A(c),bodyStyle:{padding:"16px"},children:e.jsxs("div",{className:"text-center space-y-2",children:[e.jsxs("div",{className:"relative",children:[e.jsx(_,{strong:!0,className:"text-lg",children:c.name}),g?.id===c.id&&e.jsx("div",{className:"absolute -top-2 -right-2 w-6 h-6 bg-blue-600 rounded-full flex items-center justify-center",children:e.jsx(C,{name:"check",className:"text-white text-sm"})})]}),e.jsx("div",{children:e.jsxs(se,{color:c.stock>0?"green":"red",className:"text-sm",children:[c.stock," in stock"]})}),c.dimensions&&e.jsxs(_,{type:"secondary",className:"text-xs block",children:[c.dimensions.length,"×",c.dimensions.width,"×",c.dimensions.height," ",c.dimensions.unit]})]})})},c.id))})]}),(x||g)&&e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[e.jsx(ge,{level:5,className:"mb-3",children:"Selection Summary"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(_,{children:"Product:"}),e.jsx(_,{strong:!0,children:l.name})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(_,{children:"Price:"}),e.jsxs(_,{strong:!0,className:"text-blue-600",children:["LKR ",(l.price||0).toFixed(2)]})]}),x&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(_,{children:"Color:"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-4 h-4 rounded-full border",style:{backgroundImage:x.image?`url(${x.image})`:"none",backgroundSize:"cover",backgroundPosition:"center",backgroundColor:x.colorCode||"#f0f0f0"}}),e.jsx(_,{strong:!0,children:x.name})]})]}),g&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(_,{children:"Size:"}),e.jsx(_,{strong:!0,children:g.name})]}),g&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(_,{children:"Stock Available:"}),e.jsxs(se,{color:g.stock>0?"green":"red",children:[g.stock," units"]})]})]})]})]})})}const{Option:js}=ce,{Text:Cs,Title:ws}=le,{Search:ps}=X;function ys({collapsed:S}){const m=ue(),l=J(r=>r.products.productsList),M=J(r=>r.categories.categoriesList),x=J(r=>r.products.loading||r.categories.loading),[R,g]=d.useState(""),[N,w]=d.useState("All"),[y,A]=d.useState(null),[h,v]=d.useState(!1),[I,c]=d.useState(!1),[z,P]=d.useState(!1);Re.useEffect(()=>{m(Ve()),m(We())},[m]);const U=["All",...(Array.isArray(M)?M.filter(r=>r?.isActive):[]).map(r=>r.name)],q=Array.isArray(l)?l.filter(r=>{if(r.isVariant)return!1;const s=r.name.toLowerCase().includes(R.toLowerCase())||r.barcode&&r.barcode.toLowerCase().includes(R.toLowerCase()),o=N==="All"||r.category===N;return s&&o}):[],$=r=>{r.colors&&r.colors.length>0?(A(r),v(!0)):r.isCustom?m(de({product:r})):(A(r),P(!0))},n=(r,s,o)=>{v(!1);const T={...y,selectedColorId:r.id,selectedColor:r,selectedSize:s.name,selectedSizeData:s,rawMaterials:s?.rawMaterials||[]};A(T),P(!0)},j=(r,s=1)=>{m(de({product:r,quantity:s,selectedColorId:r.selectedColorId,selectedSize:r.selectedSize,addons:r.addons}))},u=r=>{de(r)},O=()=>S?{xs:24,sm:12,md:8,lg:6,xl:6}:{xs:24,sm:12,md:8,lg:8,xl:8};return x?e.jsx(H,{className:"h-full",bodyStyle:{padding:0,height:"calc(100vh - 200px)"},children:e.jsx("div",{className:"p-4",children:e.jsx(Ye,{type:"product-grid"})})}):e.jsxs(e.Fragment,{children:[e.jsxs(H,{className:"h-full",bodyStyle:{padding:0,height:"calc(100vh - 200px)"},children:[e.jsx("div",{className:"p-4 border-b border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{children:e.jsx("h2",{className:"text-2xl font-bold m-0",children:"Products"})}),e.jsxs(he,{children:[e.jsx(ps,{placeholder:"Search by product name or SKU...",value:R,onChange:r=>g(r.target.value),onSearch:g,className:"w-80",size:"large"}),e.jsx(D.Primary,{size:"large",icon:"add",onClick:()=>c(!0),children:"Custom Product"})]})]})}),e.jsx("div",{className:"px-4 pt-4 border-b border-gray-200",children:e.jsx(ce,{value:N,onChange:w,className:"w-48",size:"large",children:U.map(r=>e.jsx(js,{value:r,children:r},r))})}),e.jsx("div",{className:"p-4 overflow-y-auto",style:{height:"calc(100% - 140px)"},children:q.length===0?e.jsx(Je,{icon:"inventory_2",title:"No Products Found",description:R?`No products found for "${R}"`:N==="All"?"No products available":`No products found in "${N}" category`}):e.jsx(me,{gutter:[16,16],children:q.map(r=>e.jsx(Z,{...O(),children:e.jsx(Xe,{product:{...r,price:r.price,hasColors:r.colors&&r.colors.length>0},onAddToCart:$,onClick:()=>$(r),showDetails:!0,showPriceRange:!1})},r.id))})})]}),e.jsx(hs,{open:h,onClose:()=>v(!1),product:y,onColorAndSizeSelected:n}),e.jsx(xs,{open:I,onClose:()=>c(!1),onAddToCart:u}),e.jsx(us,{open:z,onClose:()=>P(!1),product:y,onAddToCart:j})]})}const Ss=Object.freeze(Object.defineProperty({__proto__:null,ProductGrid:ys},Symbol.toStringTag,{value:"Module"})),{Title:Y,Text:i}=le,{Option:fs}=ce,{TextArea:Le}=X;function gs({open:S,onClose:m,cartItems:l,appliedCoupon:M,couponDiscount:x,itemTaxes:R,fullBillTaxes:g,categoryTaxTotal:N,fullBillTaxTotal:w}){const y=ue(),A=J(a=>a.users.usersList),{currentUser:h}=Ze(),[v,I]=d.useState(0),[c]=Q.useForm(),[z]=Q.useForm(),[P,E]=d.useState(""),[U,q]=d.useState("card"),[$,n]=d.useState(h?.id),[j,u]=d.useState(!1),[O,r]=d.useState(""),[s,o]=d.useState(null),[T,t]=d.useState(!1),[f,L]=d.useState(!1),[p,W]=d.useState({customerName:"",customerPhone:"",customerEmail:"",customerAddress:""});Re.useEffect(()=>{S&&(y(He()),W({customerName:"",customerPhone:"",customerEmail:"",customerAddress:""}),I(0),E(""),q("card"),n(h?.id),c.resetFields(),z.resetFields())},[S,y,h?.id,c,z]);const je=l.reduce((a,k)=>{let B=k.product.price*k.quantity;if(k.product.addons){const pe=k.product.addons.reduce((ne,ye)=>ne+ye.price*ye.quantity,0);B+=pe}return a+B},0),ve=je+(N||0)-(x||0),be=ve+(w||0),Ce=a=>{const k=A.find(B=>B.id===a);return k?`${k.firstName} ${k.lastName}`:"Unknown"},we=[{title:"Order Summary",description:"Review items and select sales person",icon:"receipt_long"},{title:"Customer Details",description:"Customer information and notes",icon:"person"},{title:"Payment",description:"Payment method and confirmation",icon:"payment"}],ze=async()=>{if(r(""),v===0)I(v+1);else if(v===1)try{const a=c.getFieldsValue();W(a),I(v+1)}catch{r("Error processing customer information");return}else I(v+1)},Ee=()=>{r(""),I(v-1)},qe=async()=>{u(!0),r("");try{console.log("Customer Data:",p),console.log("Payment Method:",U);const a=A.find(B=>B.id===$),k={id:`TXN-${Date.now()}`,items:l,subtotal:je,categoryTaxTotal:N||0,fullBillTaxTotal:w||0,totalTax:(N||0)+(w||0),discount:x||0,total:be,paymentMethod:U,timestamp:new Date,cashier:h?.firstName+" "+h?.lastName||"Unknown",salesperson:a?`${a.firstName} ${a.lastName}`:Ce($),salespersonId:$,customerName:p.customerName||"Walk-in Customer",customerPhone:p.customerPhone,customerEmail:p.customerEmail,customerAddress:p.customerAddress,appliedCoupon:M?.code,notes:P,status:"completed",appliedTaxes:{itemTaxes:R||[],fullBillTaxes:g||[]},items:l.map(B=>({...B,selectedColorId:B.selectedColorId,selectedSizeData:B.selectedSizeData}))};y(ts(k)),y(as()),K.success("Order completed successfully!"),o(k),m(),I(0),E(""),q("card"),n(h?.id),c.resetFields(),z.resetFields()}catch{r("Failed to complete order. Please try again."),K.error("Failed to complete order")}finally{u(!1)}},Se=()=>{o(null),t(!1),L(!1)},$e=()=>{t(!0)},Oe=()=>{L(!0)},De=()=>e.jsxs("div",{className:"space-y-4",children:[e.jsx(Y,{level:4,children:"Order Summary"}),e.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg",children:[e.jsx(Y,{level:5,className:"mb-3",children:"Sales Person"}),e.jsx(ce,{value:$,onChange:n,className:"w-full",placeholder:"Select sales person",showSearch:!0,filterOption:(a,k)=>k.children.toLowerCase().includes(a.toLowerCase()),children:A.filter(a=>a.isActive).map(a=>e.jsx(fs,{value:a.id,children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("div",{className:"w-6 h-6 bg-blue-600 rounded-full flex items-center justify-center text-white text-xs",children:[a.firstName[0],a.lastName[0]]}),e.jsxs("div",{children:[e.jsxs(i,{strong:!0,children:[a.firstName," ",a.lastName]}),e.jsxs(i,{type:"secondary",className:"ml-2 text-xs",children:["(",a.role,")"]})]})]})},a.id))}),e.jsx(i,{type:"secondary",className:"text-sm mt-2 block",children:"This person will be credited as the sales person for this order"})]}),e.jsx("div",{className:"max-h-64 overflow-y-auto border rounded-lg p-4",children:e.jsx(ee,{dataSource:l,renderItem:(a,k)=>{const B=(R||[]).filter(G=>G.productId===a.product.id),pe=B.reduce((G,ie)=>G+ie.amount,0),ne=a.product.addons?a.product.addons.reduce((G,ie)=>G+ie.price,0):0,ye=(a.product.price+ne)*a.quantity;return e.jsx(ee.Item,{className:"px-0 py-2",children:e.jsxs("div",{className:"w-full",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{children:[e.jsx(i,{strong:!0,className:"text-sm",children:a.product.name}),a.selectedSize&&e.jsxs(i,{type:"secondary",className:"text-xs block",children:["Size: ",a.selectedSize]}),a.selectedColor&&e.jsxs(i,{type:"secondary",className:"text-xs block",children:["Color: ",a.selectedColor.name]}),a.product.isCustom&&e.jsx(se,{color:"purple",className:"ml-1",children:"Custom"})]}),e.jsxs(i,{strong:!0,className:"text-blue-600",children:["LKR ",ye.toFixed(2)]})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm text-gray-500",children:[e.jsxs(i,{type:"secondary",children:["LKR ",a.product.price.toFixed(2)," × ",a.quantity,ne>0&&` + LKR ${ne.toFixed(2)} addons`,pe>0&&` + LKR ${pe.toFixed(2)} tax`]}),e.jsxs(i,{type:"secondary",children:["SKU: ",a.product.barcode]})]}),a.product.addons&&a.product.addons.length>0&&e.jsx("div",{className:"mt-1 pl-4 border-l-2 border-blue-200",children:a.product.addons.map((G,ie)=>e.jsxs(i,{type:"secondary",className:"text-xs block",children:[G.name," × ",G.quantity,": +LKR ",G.price.toFixed(2)]},ie))}),B.length>0&&e.jsx("div",{className:"mt-1",children:B.map(G=>e.jsxs(i,{type:"secondary",className:"text-xs block",children:[G.taxName," (",G.rate,"%): +LKR ",G.amount.toFixed(2)]},G.taxId))})]})})}})}),e.jsxs("div",{className:"border-t pt-4 space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx(i,{children:"Subtotal"}),e.jsxs(i,{children:["LKR ",(je||0).toFixed(2)]})]}),N>0&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx(i,{children:"Category Taxes"}),e.jsxs(i,{children:["LKR ",(N||0).toFixed(2)]})]}),M&&e.jsxs("div",{className:"flex justify-between",children:[e.jsxs(i,{className:"text-green-600",children:["Coupon (",M.code,")"]}),e.jsxs(i,{className:"text-green-600",children:["-LKR ",(x||0).toFixed(2)]})]}),g&&g.map(a=>e.jsxs("div",{className:"flex justify-between",children:[e.jsxs(i,{children:[a.name," (",a.rate,"%)"]}),e.jsxs(i,{children:["LKR ",(ve*(a.rate||0)/100).toFixed(2)]})]},a.id)),e.jsx(ae,{className:"my-2"}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx(Y,{level:5,className:"m-0",children:"Total"}),e.jsxs(Y,{level:4,className:"m-0 text-blue-600",children:["LKR ",(be||0).toFixed(2)]})]})]})]}),_e=()=>e.jsxs("div",{className:"space-y-4",children:[e.jsx(Y,{level:4,children:"Customer Information"}),e.jsxs(Q,{form:c,layout:"vertical",preserve:!0,children:[e.jsxs(me,{gutter:16,children:[e.jsx(Z,{span:12,children:e.jsx(Q.Item,{name:"customerName",label:"Customer Name",children:e.jsx(X,{prefix:e.jsx(C,{name:"person",className:"text-gray-400"}),placeholder:"Enter customer name (optional)",onChange:a=>{W(k=>({...k,customerName:a.target.value}))}})})}),e.jsx(Z,{span:12,children:e.jsx(Q.Item,{name:"customerPhone",label:"Phone Number",children:e.jsx(X,{prefix:e.jsx(C,{name:"phone",className:"text-gray-400"}),placeholder:"Enter phone number (optional)",onChange:a=>{W(k=>({...k,customerPhone:a.target.value}))}})})})]}),e.jsx(Q.Item,{name:"customerEmail",label:"Email Address",children:e.jsx(X,{prefix:e.jsx(C,{name:"email",className:"text-gray-400"}),placeholder:"Enter email address (optional)",type:"email",onChange:a=>{W(k=>({...k,customerEmail:a.target.value}))}})}),e.jsx(Q.Item,{name:"customerAddress",label:"Delivery Address",children:e.jsx(Le,{placeholder:"Enter delivery address (optional)",rows:3,onChange:a=>{W(k=>({...k,customerAddress:a.target.value}))}})})]}),e.jsx(ae,{}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(i,{strong:!0,children:"Order Notes"}),e.jsx(Le,{value:P,onChange:a=>E(a.target.value),placeholder:"Add special instructions or notes for this order...",rows:3})]})]}),Qe=()=>e.jsxs("div",{className:"space-y-4",children:[e.jsx(Y,{level:4,children:"Payment Method"}),e.jsx(Q,{form:z,layout:"vertical",children:e.jsx(Q.Item,{name:"paymentMethod",label:"Select Payment Method",children:e.jsx(fe.Group,{value:U,onChange:a=>q(a.target.value),className:"w-full",children:e.jsxs(he,{direction:"vertical",className:"w-full",children:[e.jsx(fe,{value:"card",className:"w-full p-4 border rounded-lg",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(C,{name:"credit_card",className:"text-blue-500",size:"text-xl"}),e.jsxs("div",{children:[e.jsx(i,{strong:!0,children:"Credit/Debit Card"}),e.jsx("br",{}),e.jsx(i,{type:"secondary",className:"text-sm",children:"Pay with card"})]})]})}),e.jsx(fe,{value:"cash",className:"w-full p-4 border rounded-lg",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(C,{name:"payments",className:"text-green-500",size:"text-xl"}),e.jsxs("div",{children:[e.jsx(i,{strong:!0,children:"Cash"}),e.jsx("br",{}),e.jsx(i,{type:"secondary",className:"text-sm",children:"Pay with cash"})]})]})}),e.jsx(fe,{value:"digital",className:"w-full p-4 border rounded-lg",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(C,{name:"smartphone",className:"text-purple-500",size:"text-xl"}),e.jsxs("div",{children:[e.jsx(i,{strong:!0,children:"Digital Wallet"}),e.jsx("br",{}),e.jsx(i,{type:"secondary",className:"text-sm",children:"Apple Pay, Google Pay, etc."})]})]})})]})})})}),e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[e.jsx(Y,{level:5,className:"mb-3",children:"Final Order Summary"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx(i,{children:"Sales Person:"}),e.jsx(i,{strong:!0,children:Ce($)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsxs(i,{children:["Items (",l.length,")"]}),e.jsxs(i,{children:["LKR ",je.toFixed(2)]})]}),N>0&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx(i,{children:"Category Taxes"}),e.jsxs(i,{children:["LKR ",N.toFixed(2)]})]}),M&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx(i,{className:"text-green-600",children:"Discount"}),e.jsxs(i,{className:"text-green-600",children:["-LKR ",x.toFixed(2)]})]}),g&&g.map(a=>e.jsxs("div",{className:"flex justify-between",children:[e.jsx(i,{children:a.name}),e.jsxs(i,{children:["LKR ",(ve*a.rate/100).toFixed(2)]})]},a.id)),e.jsx(ae,{className:"my-2"}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx(Y,{level:4,className:"m-0",children:"Total"}),e.jsxs(Y,{level:4,className:"m-0 text-blue-600",children:["LKR ",be.toFixed(2)]})]})]})]})]}),Ue=()=>{switch(v){case 0:return De();case 1:return _e();case 2:return Qe();default:return null}};return e.jsxs(e.Fragment,{children:[e.jsx(xe,{title:"Complete Order",open:S,onCancel:m,width:800,footer:null,children:e.jsxs("div",{className:"space-y-6",children:[e.jsx(Ke,{current:v,steps:we,status:O?"error":"process",errorMessage:O}),e.jsx("div",{className:"min-h-[400px]",children:Ue()}),e.jsxs("div",{className:"flex justify-between pt-4 border-t",children:[e.jsx("div",{children:v>0&&e.jsxs(D,{onClick:Ee,children:[e.jsx(C,{name:"arrow_back",className:"mr-2"}),"Previous"]})}),e.jsxs("div",{className:"space-x-2",children:[e.jsx(D,{onClick:m,children:"Cancel"}),v<we.length-1?e.jsxs(D.Primary,{onClick:ze,children:["Next",e.jsx(C,{name:"arrow_forward",className:"ml-2"})]}):e.jsx(D.Primary,{onClick:qe,loading:j,icon:"check",children:"Complete Order"})]})]})]})}),s&&e.jsx(xe,{title:"Order Completed Successfully!",open:!!s&&!T&&!f,onCancel:Se,width:600,footer:[e.jsx(D,{onClick:Se,children:"Close"},"close"),e.jsx(D,{icon:"label",onClick:Oe,children:"Print Inventory Labels"},"inventory-labels"),e.jsx(D.Primary,{icon:"receipt_long",onClick:$e,children:"View Invoice"},"invoice")],children:e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(C,{name:"check",className:"text-green-600 text-2xl"})}),e.jsx(Y,{level:3,className:"text-green-600 mb-2",children:"Order Completed!"}),e.jsxs(i,{type:"secondary",className:"text-lg block mb-4",children:["Order ",s.id," has been processed successfully."]}),e.jsx("div",{className:"bg-gray-50 p-4 rounded-lg",children:e.jsxs(me,{gutter:16,children:[e.jsx(Z,{span:6,children:e.jsxs("div",{className:"text-center",children:[e.jsx(i,{strong:!0,className:"text-lg block",children:s.items.length}),e.jsx(i,{type:"secondary",className:"text-sm",children:"Items"})]})}),e.jsx(Z,{span:6,children:e.jsxs("div",{className:"text-center",children:[e.jsx(i,{strong:!0,className:"text-lg block",children:s.items.reduce((a,k)=>a+k.quantity,0)}),e.jsx(i,{type:"secondary",className:"text-sm",children:"Total Quantity"})]})}),e.jsx(Z,{span:6,children:e.jsxs("div",{className:"text-center",children:[e.jsx(i,{strong:!0,className:"text-lg block",children:s.salesperson}),e.jsx(i,{type:"secondary",className:"text-sm",children:"Sales Person"})]})}),e.jsx(Z,{span:6,children:e.jsxs("div",{className:"text-center",children:[e.jsxs(i,{strong:!0,className:"text-lg block text-blue-600",children:["LKR ",s.total.toFixed(2)]}),e.jsx(i,{type:"secondary",className:"text-sm",children:"Total Amount"})]})})]})}),e.jsx("div",{className:"mt-4 p-3 bg-blue-50 rounded-lg",children:e.jsxs(i,{className:"text-sm",children:[e.jsx(C,{name:"info",className:"mr-2 text-blue-600"}),"You can now print inventory labels for each item or view the detailed invoice."]})})]})}),e.jsx(es,{open:T,onClose:()=>{t(!1)},transaction:s,type:"detailed"}),e.jsx(ss,{open:f,onClose:()=>{L(!1)},transaction:s})]})}const{Title:Fe,Text:b}=le;function Ns(){const S=ue(),m=J(s=>s.cart.cart),l=J(s=>s.taxes.taxesList),M=J(s=>s.coupons.couponsList);J(s=>s.cart.loading||s.taxes.loading||s.coupons.loading);const{checkRawMaterialAvailability:x}=rs(),[R,g]=d.useState(!1),[N,w]=d.useState(null),[y,A]=d.useState(""),[h,v]=d.useState({unavailableMaterials:[],lowMaterials:[]});if(!m)return e.jsx(H,{className:"h-full",bodyStyle:{padding:0,height:"calc(100vh - 200px)"},title:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("h2",{className:"text-xl font-bold m-0",children:"Current Order"}),e.jsx(Ne,{count:0,size:"small"})]})}),children:e.jsx("div",{className:"flex flex-col h-full items-center justify-center",children:e.jsx(te,{image:te.PRESENTED_IMAGE_SIMPLE,description:"Loading cart...",className:"flex flex-col items-center justify-center h-full"})})});d.useEffect(()=>{if(m&&m.length>0){const s=x(m);v(s)}else v({unavailableMaterials:[],lowMaterials:[]})},[m,x]),d.useEffect(()=>{S(ls()),S(cs())},[S]);const I=()=>{const s=Array.isArray(l)?l.filter(t=>t.isActive):[];let o=[];m.forEach(t=>{s.filter(L=>L.taxType==="category"&&Array.isArray(L.applicableCategories)&&L.applicableCategories.includes(t.product.category)).forEach(L=>{const p=t.product.price*t.quantity*L.rate/100;o.push({taxId:L.id,taxName:L.name,rate:L.rate,amount:p,productId:t.product.id,productName:t.product.name})})});const T=s.filter(t=>t&&t.taxType==="full_bill");return{itemTaxes:o,fullBillTaxes:T}},{itemTaxes:c,fullBillTaxes:z}=I(),P=m.reduce((s,o)=>{let T=o.product.price*o.quantity;if(o.product.addons){const t=o.product.addons.reduce((f,L)=>f+L.price,0)*o.quantity;T+=t}return s+T},0),E=c.reduce((s,o)=>s+o.amount,0),U=N?P*N.discountPercent/100:0,q=P+E-U,$=z.reduce((s,o)=>s+q*o.rate/100,0),n=q+$,j=(s,o,T)=>{if(T<=0){const t=m.find(f=>f.product.id===s&&f.selectedSize===o);S(ke({productId:s,selectedColorId:t?.selectedColorId,selectedSize:o}))}else{const t=m.find(f=>f.product.id===s&&f.selectedSize===o);S(ns({productId:s,selectedColorId:t?.selectedColorId,selectedSize:o,quantity:T}))}},u=()=>{const s=M?.find(o=>o.code===y&&o.isActive);if(s){const o=new Date,T=s.validTo&&new Date(s.validTo)<o,t=s.usageLimit&&s.usedCount>=s.usageLimit,f=!s.minimumAmount||P>=s.minimumAmount;if(T){K.error("Coupon has expired");return}if(t){K.error("Coupon usage limit reached");return}if(!f){K.error(`Minimum order amount is LKR ${s.minimumAmount}`);return}w(s),K.success(`Coupon applied! ${s.discountPercent}% discount`),A("")}else K.error("Invalid or expired coupon code")},O=()=>{w(null),K.info("Coupon removed")},r=()=>{if(m.length===0){K.warning("Cart is empty");return}h.unavailableMaterials.length>0?K.warning("Some raw materials are out of stock. Production may be delayed."):h.lowMaterials.length>0&&K.warning("Some raw materials are running low. Consider restocking soon."),g(!0)};return e.jsxs(e.Fragment,{children:[e.jsx(H,{className:"h-full",bodyStyle:{padding:0,height:"calc(100vh - 200px)"},title:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("h2",{className:"text-xl font-bold m-0",children:"Current Order"}),e.jsx(Ne,{count:m.length,size:"small"})]})}),children:e.jsxs("div",{className:"flex flex-col h-full",children:[(h.unavailableMaterials.length>0||h.lowMaterials.length>0)&&e.jsxs("div",{className:"p-4 border-b",children:[h.unavailableMaterials.length>0&&e.jsx(Pe,{type:"error",showIcon:!0,message:"Raw Materials Out of Stock",description:e.jsxs("div",{className:"space-y-1",children:[h.unavailableMaterials.map((s,o)=>e.jsxs("div",{className:"text-sm",children:[e.jsx(b,{strong:!0,children:s.materialName})," needed for"," ",e.jsx(b,{children:s.productName})," - Required: ",s.required," ",s.unit,", Available: ",s.available," ",s.unit]},o)),e.jsx(b,{type:"secondary",className:"text-xs block mt-2",children:"You can still proceed with the order, but production may be delayed."})]}),className:"mb-2"}),h.lowMaterials.length>0&&e.jsx(Pe,{type:"warning",showIcon:!0,message:"Raw Materials Running Low",description:e.jsxs("div",{className:"space-y-1",children:[h.lowMaterials.map((s,o)=>e.jsxs("div",{className:"text-sm",children:[e.jsx(b,{strong:!0,children:s.materialName})," for"," ",e.jsx(b,{children:s.productName})," - Required: ",s.required," ",s.unit,", Available: ",s.available," ",s.unit]},o)),e.jsx(b,{type:"secondary",className:"text-xs block mt-2",children:"Consider restocking these materials soon."})]})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4",children:m.length===0?e.jsx(te,{image:te.PRESENTED_IMAGE_SIMPLE,description:"Your cart is empty",className:"flex flex-col items-center justify-center h-full"}):e.jsx(ee,{dataSource:m,renderItem:(s,o)=>{const T=c.filter(p=>p.productId===s.product.id),t=T.reduce((p,W)=>p+W.amount,0),f=s.product.addons?s.product.addons.reduce((p,W)=>p+W.price,0)*s.quantity:0,L=s.product.price*s.quantity+f;return e.jsx(ee.Item,{className:"px-0 py-3 border-b border-gray-100",children:e.jsxs("div",{className:"w-full",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Ne,{count:o+1,size:"small",color:"#0E72BD"}),e.jsxs("div",{children:[e.jsx(b,{strong:!0,className:"text-sm",children:s.product.name}),s.selectedSize&&e.jsxs(b,{type:"secondary",className:"text-xs block",children:["Size: ",s.selectedSize]}),s.selectedColor&&e.jsxs(b,{type:"secondary",className:"text-xs block",children:["Color: ",s.selectedColor.name]}),s.product.isCustom&&e.jsx(se,{color:"purple",className:"ml-1",children:"Custom"})]})]}),e.jsx(Ge,{title:"Remove item?",onConfirm:()=>S(ke({productId:s.product.id,selectedColorId:s.selectedColorId,selectedSize:s.selectedSize})),children:e.jsx(D.Text,{icon:"close",size:"small",className:"text-gray-400 hover:text-red-500"})})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs(b,{className:"text-sm",children:["LKR ",s.product.price.toFixed(2)]}),e.jsx(oe,{min:1,max:100,value:s.quantity,onChange:p=>j(s.product.id,s.selectedSize,p||1),size:"small",className:"w-16"})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs(b,{strong:!0,className:"text-blue-600",children:["LKR ",(L||0).toFixed(2)]}),t>0&&e.jsxs(b,{type:"secondary",className:"text-xs block",children:["+LKR ",(t||0).toFixed(2)," tax"]})]})]}),s.product.addons&&Array.isArray(s.product.addons)&&s.product.addons.length>0&&e.jsxs("div",{className:"mt-1 pl-4 border-l-2 border-blue-200",children:[e.jsx(b,{type:"secondary",className:"text-xs",children:"Addons:"}),s.product.addons.map((p,W)=>e.jsxs("div",{className:"flex justify-between text-xs",children:[e.jsxs(b,{type:"secondary",children:[p.name||"Addon"," × ",p.quantity||1]}),e.jsxs(b,{type:"secondary",children:["+LKR ",(p.price||0).toFixed(2)]})]},W))]}),T.length>0&&e.jsx("div",{className:"mt-1",children:T.map(p=>e.jsxs(b,{type:"secondary",className:"text-xs block",children:[p.taxName||"Tax"," (",p.rate||0,"%): +LKR ",(p.amount||0).toFixed(2)]},p.taxId))}),e.jsx("div",{className:"mt-1",children:e.jsx(b,{type:"secondary",className:"text-xs",children:t>0&&` + LKR ${t.toFixed(2)} tax`})})]})})}})}),e.jsx("div",{className:"border-t border-gray-200 p-4 space-y-3",children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx(b,{children:"Subtotal"}),e.jsxs(b,{children:["LKR ",(P||0).toFixed(2)]})]}),E>0&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx(b,{children:"Category Taxes"}),e.jsxs(b,{children:["LKR ",(E||0).toFixed(2)]})]}),e.jsx("div",{className:"space-y-2",children:N?e.jsxs("div",{className:"p-2 bg-green-50 border border-green-200 rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(b,{strong:!0,className:"text-green-800 text-sm",children:N.code}),e.jsx("br",{}),e.jsxs(b,{className:"text-green-600 text-xs",children:[N.discountPercent,"% discount"]})]}),e.jsx(D.Text,{icon:"close",danger:!0,size:"small",onClick:O})]}),e.jsxs("div",{className:"flex justify-between mt-1",children:[e.jsx(b,{className:"text-green-600 text-sm",children:"Discount"}),e.jsxs(b,{className:"text-green-600 text-sm",children:["-LKR ",(U||0).toFixed(2)]})]})]}):e.jsx("div",{className:"space-y-2",children:e.jsxs("div",{className:"flex space-x-1",children:[e.jsx(X,{placeholder:"Coupon code",value:y,onChange:s=>A(s.target.value),size:"middle",onPressEnter:u,className:"flex-1"}),e.jsx(re,{size:"middle",type:"primary",onClick:u,disabled:!y.trim(),children:"Apply"})]})})}),z.map(s=>e.jsxs("div",{className:"flex justify-between",children:[e.jsxs(b,{children:[s.name," (",s.rate,"%)"]}),e.jsxs(b,{children:["LKR ",(q*(s.rate||0)/100).toFixed(2)]})]},s.id)),e.jsx(ae,{className:"my-2"}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx(Fe,{level:5,className:"m-0",children:"Total"}),e.jsxs(Fe,{level:4,className:"m-0 text-blue-600",children:["LKR ",(n||0).toFixed(2)]})]})]})}),e.jsx("div",{className:"border-t border-gray-200 p-4",children:e.jsxs(re,{type:"primary",icon:e.jsx(C,{name:"arrow_forward"}),size:"large",block:!0,onClick:r,disabled:m.length===0,className:"bg-blue-600 hover:bg-blue-700 h-12 text-lg font-semibold",children:["Proceed to Checkout",(h.unavailableMaterials.length>0||h.lowMaterials.length>0)&&e.jsx(C,{name:"warning",className:"ml-2 text-yellow-300"})]})})]})}),e.jsx(gs,{open:R,onClose:()=>g(!1),cartItems:m,orderTotal:n,appliedCoupon:N,couponDiscount:U,itemTaxes:c,fullBillTaxes:z,categoryTaxTotal:E,fullBillTaxTotal:$})]})}const Ps=Object.freeze(Object.defineProperty({__proto__:null,Cart:Ns},Symbol.toStringTag,{value:"Module"}));export{Ps as C,Ss as P};
