import{F as h,r as g,j as e,y as ue,O as pe,R as ce,C as _,K as z,I as H,D as De,N as Ne,B as T,b as ge,Q as we,T as le,H as W,A as Ae,S as X,s as u,f as ne,G as Ce,J as $e,x as _e,z as K,$ as qe,p as Ge,u as Ee,a as oe,c as he}from"./react-core-BYkUdBdl.js";import{I as O,u as Fe,y as Be,A as re,S as Me,z as Pe,B as Ue,C as Je,G as Ke,b as Qe,f as ze,L as He,v as We,H as ke,J as Xe,K as Te}from"./index-CNNU94z7.js";import{d as ye}from"./date-utils-DpdzE7my.js";import{h as Se,E as Ie}from"./pdf-utils-Bnf-IKEy.js";import"./utility-libs-C6oKIWOz.js";import"./react-state-DIKZUrF8.js";const{Title:Ye,Text:Z}=le,{Option:q}=z,{TextArea:be}=H,{TabPane:Oe}=pe;function Ze({open:l,onClose:x,onSubmit:r,editingOrder:c=null,products:p=[],rawMaterials:R=[]}){const[b]=h.useForm(),[j]=h.useForm(),[A,S]=g.useState(!1),[v,L]=g.useState([]),[k,V]=g.useState("1"),[M,G]=g.useState("product"),[i,I]=g.useState([{id:"V001",name:"Premium Wood Co.",email:"orders@premiumwood.com",phone:"123-456-7890",address:"123 Wood Lane, Timber City"},{id:"V002",name:"MetalWorks Inc.",email:"sales@metalworks.com",phone:"234-567-8901",address:"456 Steel Ave, Metal Town"},{id:"V003",name:"Luxury Fabrics Inc.",email:"orders@luxuryfabrics.com",phone:"345-678-9012",address:"789 Textile Blvd, Fabric City"},{id:"V004",name:"FastenRight Co.",email:"support@fastenright.com",phone:"456-789-0123",address:"101 Screw Drive, Fastener Village"},{id:"V005",name:"Crystal Glass Co.",email:"orders@crystalglass.com",phone:"567-890-1234",address:"202 Clear View, Glass City"}]);g.useEffect(()=>{c&&l?(b.setFieldsValue({vendorId:c.vendorId,vendorName:c.vendorName,vendorEmail:c.vendorEmail,vendorPhone:c.vendorPhone,vendorAddress:c.vendorAddress,orderDate:ye(c.orderDate),expectedDeliveryDate:c.expectedDeliveryDate?ye(c.expectedDeliveryDate):null,shippingAddress:c.shippingAddress,notes:c.notes,paymentTerms:c.paymentTerms,shippingMethod:c.shippingMethod}),L(c.items||[]),V("1")):l&&(b.resetFields(),b.setFieldsValue({orderDate:ye()}),L([]),V("1"))},[c,l,b]);const U=t=>{const n=i.find(d=>d.id===t);n&&b.setFieldsValue({vendorName:n.name,vendorEmail:n.email,vendorPhone:n.phone,vendorAddress:n.address})},B=t=>{const{itemId:n,quantity:d,unitPrice:f}=t,N=v.findIndex(y=>y.itemId===n&&y.type===M);if(N>=0){const y=[...v];y[N]={...y[N],quantity:y[N].quantity+d,unitPrice:f,total:(y[N].quantity+d)*f},L(y),u.success("Item quantity updated")}else{let y;if(M==="product"){const C=p.find($=>$.id===n);if(!C){u.error("Product not found");return}y={itemId:n,type:"product",name:C.name,sku:C.barcode,category:C.category,quantity:d,unitPrice:f,total:d*f}}else{const C=R.find($=>$.id===n);if(!C){u.error("Raw material not found");return}y={itemId:n,type:"material",name:C.name,sku:C.id,category:C.category,unit:C.unit,quantity:d,unitPrice:f,total:d*f}}L([...v,y]),u.success("Item added successfully")}j.resetFields()},ie=(t,n)=>{L(v.filter(d=>!(d.itemId===t&&d.type===n))),u.success("Item removed")},s=async()=>{try{S(!0);const t=await b.validateFields();if(v.length===0){u.error("Please add at least one item to the purchase order"),S(!1);return}const n=v.reduce((N,y)=>N+y.total,0),d={...t,orderDate:t.orderDate.toDate(),expectedDeliveryDate:t.expectedDeliveryDate?t.expectedDeliveryDate.toDate():null,items:v,total:n,status:c?.status||"draft"};await r(d)&&x()}catch(t){console.error("Error submitting purchase order:",t),u.error("Please fill in all required fields")}finally{S(!1)}},m=[{title:"Type",dataIndex:"type",key:"type",width:100,render:t=>e.jsx(ne,{color:t==="product"?"blue":"green",children:t==="product"?"Product":"Material"})},{title:"Name",dataIndex:"name",key:"name",render:(t,n)=>e.jsxs("div",{children:[e.jsx(Z,{strong:!0,children:t}),e.jsx("br",{}),e.jsxs(Z,{type:"secondary",className:"text-xs",children:["SKU: ",n.sku," | ",n.category]})]})},{title:"Quantity",key:"quantity",width:120,render:t=>e.jsxs(Z,{children:[t.quantity," ",t.unit||"units"]})},{title:"Unit Price",dataIndex:"unitPrice",key:"unitPrice",width:120,render:t=>e.jsxs(Z,{children:["LKR ",t.toFixed(2)]})},{title:"Total",dataIndex:"total",key:"total",width:120,render:t=>e.jsxs(Z,{strong:!0,children:["LKR ",t.toFixed(2)]})},{title:"Actions",key:"actions",width:80,render:t=>e.jsx(Ce,{title:"Remove this item?",onConfirm:()=>ie(t.itemId,t.type),children:e.jsx(T,{type:"text",danger:!0,icon:e.jsx(O,{name:"delete"}),size:"small"})})}],D=v.reduce((t,n)=>t+n.total,0);return e.jsx(ue,{title:e.jsxs(X,{children:[e.jsx(O,{name:"shopping_cart",className:"text-blue-600"}),e.jsx("span",{children:c?"Edit Purchase Order":"Create Purchase Order"})]}),open:l,onCancel:x,width:1e3,footer:null,destroyOnClose:!0,children:e.jsxs(pe,{activeKey:k,onChange:V,children:[e.jsxs(Oe,{tab:e.jsxs("span",{children:[e.jsx(O,{name:"store",className:"mr-2"}),"Vendor Details"]}),children:[e.jsxs(h,{form:b,layout:"vertical",className:"mt-4",children:[e.jsxs(ce,{gutter:16,children:[e.jsx(_,{span:12,children:e.jsx(h.Item,{name:"vendorId",label:"Select Vendor",children:e.jsx(z,{placeholder:"Select a vendor",onChange:U,allowClear:!0,showSearch:!0,filterOption:(t,n)=>n.children.toLowerCase().includes(t.toLowerCase()),children:i.map(t=>e.jsx(q,{value:t.id,children:t.name},t.id))})})}),e.jsx(_,{span:12,children:e.jsx(h.Item,{name:"vendorName",label:"Vendor Name",rules:[{required:!0,message:"Please enter vendor name"}],children:e.jsx(H,{placeholder:"Enter vendor name"})})})]}),e.jsxs(ce,{gutter:16,children:[e.jsx(_,{span:12,children:e.jsx(h.Item,{name:"vendorEmail",label:"Vendor Email",children:e.jsx(H,{placeholder:"Enter vendor email"})})}),e.jsx(_,{span:12,children:e.jsx(h.Item,{name:"vendorPhone",label:"Vendor Phone",children:e.jsx(H,{placeholder:"Enter vendor phone"})})})]}),e.jsx(h.Item,{name:"vendorAddress",label:"Vendor Address",children:e.jsx(be,{rows:3,placeholder:"Enter vendor address"})}),e.jsx(De,{}),e.jsxs(ce,{gutter:16,children:[e.jsx(_,{span:12,children:e.jsx(h.Item,{name:"orderDate",label:"Order Date",rules:[{required:!0,message:"Please select order date"}],children:e.jsx(Ne,{className:"w-full"})})}),e.jsx(_,{span:12,children:e.jsx(h.Item,{name:"expectedDeliveryDate",label:"Expected Delivery Date",children:e.jsx(Ne,{className:"w-full"})})})]}),e.jsxs(ce,{gutter:16,children:[e.jsx(_,{span:12,children:e.jsx(h.Item,{name:"paymentTerms",label:"Payment Terms",children:e.jsxs(z,{placeholder:"Select payment terms",children:[e.jsx(q,{value:"net30",children:"Net 30"}),e.jsx(q,{value:"net60",children:"Net 60"}),e.jsx(q,{value:"net90",children:"Net 90"}),e.jsx(q,{value:"cod",children:"Cash on Delivery"}),e.jsx(q,{value:"prepaid",children:"Prepaid"})]})})}),e.jsx(_,{span:12,children:e.jsx(h.Item,{name:"shippingMethod",label:"Shipping Method",children:e.jsxs(z,{placeholder:"Select shipping method",children:[e.jsx(q,{value:"standard",children:"Standard Shipping"}),e.jsx(q,{value:"express",children:"Express Shipping"}),e.jsx(q,{value:"overnight",children:"Overnight Shipping"}),e.jsx(q,{value:"pickup",children:"Vendor Pickup"})]})})})]}),e.jsx(h.Item,{name:"shippingAddress",label:"Ship To Address",rules:[{required:!0,message:"Please enter shipping address"}],children:e.jsx(be,{rows:3,placeholder:"Enter shipping address"})}),e.jsx(h.Item,{name:"notes",label:"Notes",children:e.jsx(be,{rows:3,placeholder:"Enter any additional notes or instructions"})})]}),e.jsx("div",{className:"flex justify-end mt-4",children:e.jsxs(T,{type:"primary",onClick:()=>V("2"),className:"bg-blue-600",children:["Next: Add Items",e.jsx(O,{name:"arrow_forward",className:"ml-2"})]})})]},"1"),e.jsx(Oe,{tab:e.jsxs("span",{children:[e.jsx(O,{name:"inventory_2",className:"mr-2"}),"Order Items"]}),children:e.jsxs("div",{className:"space-y-6",children:[e.jsx(ge,{size:"small",title:"Add Items",children:e.jsxs(h,{form:j,layout:"horizontal",onFinish:B,children:[e.jsxs(ce,{gutter:16,children:[e.jsx(_,{span:6,children:e.jsx(h.Item,{name:"itemType",label:"Item Type",initialValue:"product",children:e.jsxs(z,{onChange:G,children:[e.jsx(q,{value:"product",children:"Product"}),e.jsx(q,{value:"material",children:"Raw Material"})]})})}),e.jsx(_,{span:10,children:e.jsx(h.Item,{name:"itemId",label:"Select Item",rules:[{required:!0,message:"Please select an item"}],children:e.jsx(z,{placeholder:`Select ${M==="product"?"product":"raw material"}`,showSearch:!0,filterOption:(t,n)=>n.children.toLowerCase().includes(t.toLowerCase()),children:M==="product"?p.filter(t=>!t.isVariant).map(t=>e.jsxs(q,{value:t.id,children:[t.name," - ",t.category]},t.id)):R.map(t=>e.jsxs(q,{value:t.id,children:[t.name," - ",t.category," (",t.unit,")"]},t.id))})})}),e.jsx(_,{span:4,children:e.jsx(h.Item,{name:"quantity",label:"Quantity",rules:[{required:!0,message:"Required"}],initialValue:1,children:e.jsx(we,{min:1,className:"w-full"})})}),e.jsx(_,{span:4,children:e.jsx(h.Item,{name:"unitPrice",label:"Unit Price",rules:[{required:!0,message:"Required"}],initialValue:0,children:e.jsx(we,{min:0,step:.01,className:"w-full",formatter:t=>`LKR ${t}`,parser:t=>t.replace(/LKR\s?/,"")})})})]}),e.jsx(h.Item,{children:e.jsx(T,{type:"primary",htmlType:"submit",icon:e.jsx(O,{name:"add"}),children:"Add Item"})})]})}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx(Ye,{level:5,children:"Order Items"}),e.jsxs(Z,{strong:!0,className:"text-lg text-blue-600",children:["Total: LKR ",D.toFixed(2)]})]}),e.jsx(W,{columns:m,dataSource:v,rowKey:t=>`${t.type}-${t.itemId}`,pagination:!1,summary:()=>e.jsxs(W.Summary.Row,{children:[e.jsx(W.Summary.Cell,{index:0,colSpan:4,children:e.jsx(Z,{strong:!0,children:"Total"})}),e.jsx(W.Summary.Cell,{index:1,children:e.jsxs(Z,{strong:!0,className:"text-blue-600",children:["LKR ",D.toFixed(2)]})}),e.jsx(W.Summary.Cell,{index:2})]})})]}),v.length===0&&e.jsx(Ae,{message:"No Items Added",description:"Please add at least one product or raw material to the purchase order.",type:"info",showIcon:!0}),e.jsxs("div",{className:"flex justify-between mt-6",children:[e.jsxs(T,{onClick:()=>V("1"),children:[e.jsx(O,{name:"arrow_back",className:"mr-2"}),"Back to Vendor Details"]}),e.jsxs(X,{children:[e.jsx(T,{onClick:x,children:"Cancel"}),e.jsxs(T,{type:"primary",onClick:s,loading:A,disabled:v.length===0,className:"bg-blue-600",children:[c?"Update":"Create"," Purchase Order"]})]})]})]})},"2")]})})}const{Title:ee,Text:P}=le;function et({order:l,id:x}){if(!l)return null;const r=c=>new Date(c).toLocaleDateString();return e.jsxs("div",{id:x,className:"p-8 bg-white",style:{width:"210mm",fontFamily:"Arial, sans-serif"},children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsxs("div",{className:"flex items-center justify-center space-x-4 mb-4",children:[e.jsx("div",{className:"w-16 h-16 bg-blue-600 rounded-xl flex items-center justify-center",children:e.jsx("img",{src:localStorage.getItem("vcare_branding")&&JSON.parse(localStorage.getItem("vcare_branding")).logoPreview?JSON.parse(localStorage.getItem("vcare_branding")).logoPreview:"/VCARELogo 1.png",alt:"VCare Logo",className:"w-10 h-10 object-contain"})}),e.jsxs("div",{children:[e.jsx(ee,{level:2,className:"m-0 text-blue-600",children:localStorage.getItem("vcare_branding")&&JSON.parse(localStorage.getItem("vcare_branding")).businessName?JSON.parse(localStorage.getItem("vcare_branding")).businessName:"VCare Furniture Store"}),e.jsx(P,{type:"secondary",children:localStorage.getItem("vcare_branding")&&JSON.parse(localStorage.getItem("vcare_branding")).tagline?JSON.parse(localStorage.getItem("vcare_branding")).tagline:"Premium Furniture Solutions"})]})]}),e.jsx(De,{}),e.jsx(ee,{level:3,className:"text-gray-800",children:"PURCHASE ORDER"}),e.jsx(P,{className:"text-lg font-bold",children:l.id})]}),e.jsxs("div",{className:"flex justify-between mb-6",children:[e.jsxs("div",{children:[e.jsx(ee,{level:5,className:"mb-2",children:"Vendor:"}),e.jsxs("div",{className:"text-sm",children:[e.jsx(P,{strong:!0,className:"block",children:l.vendorName}),l.vendorEmail&&e.jsx(P,{className:"block",children:l.vendorEmail}),l.vendorPhone&&e.jsx(P,{className:"block",children:l.vendorPhone}),l.vendorAddress&&e.jsx(P,{className:"block whitespace-pre-line",children:l.vendorAddress})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx(ee,{level:5,className:"mb-2",children:"Order Information:"}),e.jsxs("div",{className:"text-sm",children:[e.jsxs("div",{className:"mb-1",children:[e.jsx(P,{strong:!0,children:"Order Date:"})," ",r(l.orderDate)]}),l.expectedDeliveryDate&&e.jsxs("div",{className:"mb-1",children:[e.jsx(P,{strong:!0,children:"Expected Delivery:"})," ",r(l.expectedDeliveryDate)]}),e.jsxs("div",{className:"mb-1",children:[e.jsx(P,{strong:!0,children:"Status:"})," ",e.jsx("span",{className:"capitalize",children:l.status})]}),l.paymentTerms&&e.jsxs("div",{className:"mb-1",children:[e.jsx(P,{strong:!0,children:"Payment Terms:"})," ",l.paymentTerms]}),l.shippingMethod&&e.jsxs("div",{className:"mb-1",children:[e.jsx(P,{strong:!0,children:"Shipping Method:"})," ",l.shippingMethod]})]})]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx(ee,{level:5,className:"mb-2",children:"Ship To:"}),e.jsx("div",{className:"border-l-4 border-blue-600 pl-4 text-sm",children:e.jsx(P,{className:"whitespace-pre-line",children:l.shippingAddress})})]}),e.jsx(ee,{level:5,className:"mb-4",children:"Order Items:"}),e.jsxs("table",{className:"w-full border-collapse mb-6",children:[e.jsx("thead",{className:"bg-gray-100",children:e.jsxs("tr",{children:[e.jsx("th",{className:"border p-2 text-left",children:"Item"}),e.jsx("th",{className:"border p-2 text-left",children:"Type"}),e.jsx("th",{className:"border p-2 text-left",children:"SKU"}),e.jsx("th",{className:"border p-2 text-right",children:"Quantity"}),e.jsx("th",{className:"border p-2 text-right",children:"Unit Price"}),e.jsx("th",{className:"border p-2 text-right",children:"Total"})]})}),e.jsx("tbody",{children:l.items.map((c,p)=>e.jsxs("tr",{children:[e.jsxs("td",{className:"border p-2",children:[e.jsx(P,{strong:!0,children:c.name}),e.jsx("br",{}),e.jsx(P,{type:"secondary",className:"text-xs",children:c.category})]}),e.jsx("td",{className:"border p-2 capitalize",children:c.type}),e.jsx("td",{className:"border p-2",children:c.sku}),e.jsxs("td",{className:"border p-2 text-right",children:[c.quantity," ",c.unit||"units"]}),e.jsxs("td",{className:"border p-2 text-right",children:["LKR ",c.unitPrice.toFixed(2)]}),e.jsxs("td",{className:"border p-2 text-right",children:["LKR ",c.total.toFixed(2)]})]},`${c.type}-${c.itemId}-${p}`))}),e.jsx("tfoot",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("td",{colSpan:5,className:"border p-2 text-right",children:e.jsx(P,{strong:!0,children:"Total:"})}),e.jsx("td",{className:"border p-2 text-right",children:e.jsxs(P,{strong:!0,children:["LKR ",l.total.toFixed(2)]})})]})})]}),l.notes&&e.jsxs("div",{className:"mb-6",children:[e.jsx(ee,{level:5,className:"mb-2",children:"Notes:"}),e.jsx("div",{className:"bg-gray-50 p-4 rounded border text-sm",children:e.jsx(P,{children:l.notes})})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx(ee,{level:5,className:"mb-2",children:"Terms & Conditions:"}),e.jsx("div",{className:"text-xs text-gray-600",children:e.jsxs("ol",{className:"list-decimal pl-4 space-y-1",children:[e.jsx("li",{children:"All prices are in LKR and exclude applicable taxes unless otherwise stated."}),e.jsx("li",{children:"Payment is due according to the terms specified in this purchase order."}),e.jsx("li",{children:"Please confirm receipt of this purchase order within 2 business days."}),e.jsx("li",{children:"Any changes to this purchase order must be approved in writing."}),e.jsx("li",{children:"Goods must be delivered to the shipping address specified above."}),e.jsx("li",{children:"All goods must be delivered in good condition and as per specifications."})]})})]}),e.jsxs("div",{className:"flex justify-between mt-12",children:[e.jsx("div",{className:"w-1/3",children:e.jsx("div",{className:"border-t border-gray-400 pt-2",children:e.jsx(P,{className:"text-sm",children:"Authorized By"})})}),e.jsx("div",{className:"w-1/3",children:e.jsx("div",{className:"border-t border-gray-400 pt-2",children:e.jsx(P,{className:"text-sm",children:"Approved By"})})}),e.jsx("div",{className:"w-1/3",children:e.jsx("div",{className:"border-t border-gray-400 pt-2",children:e.jsx(P,{className:"text-sm",children:"Received By"})})})]}),e.jsxs("div",{className:"mt-12 pt-4 border-t text-center text-xs text-gray-500",children:[e.jsxs(P,{children:[localStorage.getItem("vcare_branding")&&JSON.parse(localStorage.getItem("vcare_branding")).businessName?JSON.parse(localStorage.getItem("vcare_branding")).businessName:"VCare Furniture Store"," |",localStorage.getItem("vcare_branding")&&JSON.parse(localStorage.getItem("vcare_branding")).address?JSON.parse(localStorage.getItem("vcare_branding")).address:"123 Main Street, City, State 12345"," |",localStorage.getItem("vcare_branding")&&JSON.parse(localStorage.getItem("vcare_branding")).phoneNumber?JSON.parse(localStorage.getItem("vcare_branding")).phoneNumber:"(555) 123-4567"]}),e.jsx("br",{}),e.jsxs(P,{children:["Email: ",localStorage.getItem("vcare_branding")&&JSON.parse(localStorage.getItem("vcare_branding")).emailAddress?JSON.parse(localStorage.getItem("vcare_branding")).emailAddress:"orders@vcarefurniture.com"," | Website: ",localStorage.getItem("vcare_branding")&&JSON.parse(localStorage.getItem("vcare_branding")).website?JSON.parse(localStorage.getItem("vcare_branding")).website:"www.vcarefurniture.com"]})]})]})}const{Title:de,Text:F}=le;function tt({order:l,grnData:x,id:r}){if(!l||!x)return null;const c=p=>p?new Date(p).toLocaleDateString():"N/A";return e.jsxs("div",{id:r,className:"p-8 bg-white",style:{width:"210mm",fontFamily:"Arial, sans-serif"},children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsxs("div",{className:"flex items-center justify-center space-x-4 mb-4",children:[e.jsx("div",{className:"w-16 h-16 bg-blue-600 rounded-xl flex items-center justify-center",children:e.jsx("img",{src:localStorage.getItem("vcare_branding")&&JSON.parse(localStorage.getItem("vcare_branding")).logoPreview?JSON.parse(localStorage.getItem("vcare_branding")).logoPreview:"/VCARELogo 1.png",alt:"VCare Logo",className:"w-10 h-10 object-contain"})}),e.jsxs("div",{children:[e.jsx(de,{level:2,className:"m-0 text-blue-600",children:localStorage.getItem("vcare_branding")&&JSON.parse(localStorage.getItem("vcare_branding")).businessName?JSON.parse(localStorage.getItem("vcare_branding")).businessName:"VCare Furniture Store"}),e.jsx(F,{type:"secondary",children:localStorage.getItem("vcare_branding")&&JSON.parse(localStorage.getItem("vcare_branding")).tagline?JSON.parse(localStorage.getItem("vcare_branding")).tagline:"Premium Furniture Solutions"})]})]}),e.jsx(De,{}),e.jsx(de,{level:3,className:"text-gray-800",children:"GOODS RECEIVE NOTE"}),e.jsx(F,{className:"text-lg font-bold",children:x.id})]}),e.jsxs("div",{className:"flex justify-between mb-6",children:[e.jsxs("div",{children:[e.jsx(de,{level:5,className:"mb-2",children:"Vendor:"}),e.jsxs("div",{className:"text-sm",children:[e.jsx(F,{strong:!0,className:"block",children:l.vendorName}),l.vendorEmail&&e.jsx(F,{className:"block",children:l.vendorEmail}),l.vendorPhone&&e.jsx(F,{className:"block",children:l.vendorPhone})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx(de,{level:5,className:"mb-2",children:"Reference Information:"}),e.jsxs("div",{className:"text-sm",children:[e.jsxs("div",{className:"mb-1",children:[e.jsx(F,{strong:!0,children:"PO Number:"})," ",l.id]}),e.jsxs("div",{className:"mb-1",children:[e.jsx(F,{strong:!0,children:"PO Date:"})," ",c(l.orderDate)]}),e.jsxs("div",{className:"mb-1",children:[e.jsx(F,{strong:!0,children:"Receive Date:"})," ",c(x.receivedDate)]})]})]})]}),e.jsx(de,{level:5,className:"mb-4",children:"Received Items:"}),e.jsxs("table",{className:"w-full border-collapse mb-6",children:[e.jsx("thead",{className:"bg-gray-100",children:e.jsxs("tr",{children:[e.jsx("th",{className:"border p-2 text-left",children:"Item"}),e.jsx("th",{className:"border p-2 text-left",children:"Type"}),e.jsx("th",{className:"border p-2 text-left",children:"SKU"}),e.jsx("th",{className:"border p-2 text-right",children:"Ordered Qty"}),e.jsx("th",{className:"border p-2 text-right",children:"Received Qty"}),e.jsx("th",{className:"border p-2 text-left",children:"Notes"})]})}),e.jsx("tbody",{children:x.items.map((p,R)=>e.jsxs("tr",{children:[e.jsxs("td",{className:"border p-2",children:[e.jsx(F,{strong:!0,children:p.name}),e.jsx("br",{}),e.jsx(F,{type:"secondary",className:"text-xs",children:p.category})]}),e.jsx("td",{className:"border p-2 capitalize",children:p.type}),e.jsx("td",{className:"border p-2",children:p.sku}),e.jsxs("td",{className:"border p-2 text-right",children:[p.quantity," ",p.unit||"units"]}),e.jsxs("td",{className:"border p-2 text-right",children:[p.receivedQuantity," ",p.unit||"units"]}),e.jsx("td",{className:"border p-2",children:p.notes||"-"})]},`${p.type}-${p.itemId}-${R}`))})]}),x.notes&&e.jsxs("div",{className:"mb-6",children:[e.jsx(de,{level:5,className:"mb-2",children:"Notes:"}),e.jsx("div",{className:"bg-gray-50 p-4 rounded border text-sm",children:e.jsx(F,{children:x.notes})})]}),e.jsxs("div",{className:"flex justify-between mt-12",children:[e.jsx("div",{className:"w-1/3",children:e.jsx("div",{className:"border-t border-gray-400 pt-2",children:e.jsxs(F,{className:"text-sm",children:["Received By: ",x.receivedBy]})})}),e.jsx("div",{className:"w-1/3",children:e.jsx("div",{className:"border-t border-gray-400 pt-2",children:e.jsxs(F,{className:"text-sm",children:["Checked By: ",x.checkedBy]})})}),e.jsx("div",{className:"w-1/3",children:e.jsx("div",{className:"border-t border-gray-400 pt-2",children:e.jsx(F,{className:"text-sm",children:"Authorized Signature"})})})]}),e.jsxs("div",{className:"mt-12 pt-4 border-t text-center text-xs text-gray-500",children:[e.jsxs(F,{children:[localStorage.getItem("vcare_branding")&&JSON.parse(localStorage.getItem("vcare_branding")).businessName?JSON.parse(localStorage.getItem("vcare_branding")).businessName:"VCare Furniture Store"," |",localStorage.getItem("vcare_branding")&&JSON.parse(localStorage.getItem("vcare_branding")).address?JSON.parse(localStorage.getItem("vcare_branding")).address:"123 Main Street, City, State 12345"," |",localStorage.getItem("vcare_branding")&&JSON.parse(localStorage.getItem("vcare_branding")).phoneNumber?JSON.parse(localStorage.getItem("vcare_branding")).phoneNumber:"(555) 123-4567"]}),e.jsx("br",{}),e.jsxs(F,{children:["Email: ",localStorage.getItem("vcare_branding")&&JSON.parse(localStorage.getItem("vcare_branding")).emailAddress?JSON.parse(localStorage.getItem("vcare_branding")).emailAddress:"inventory@vcarefurniture.com"," | Website: ",localStorage.getItem("vcare_branding")&&JSON.parse(localStorage.getItem("vcare_branding")).website?JSON.parse(localStorage.getItem("vcare_branding")).website:"www.vcarefurniture.com"]}),e.jsx("br",{}),e.jsxs(F,{className:"text-xs mt-2",children:["GRN #",x.id," - Generated on ",new Date().toLocaleDateString()]})]})]})}const{Title:st,Text:ae}=le,{TextArea:at}=H;function rt({open:l,onClose:x,order:r,onComplete:c,onUpdateInventory:p}){const{users:R}=Fe(),[b]=h.useForm(),[j,A]=g.useState(!1),[S,v]=g.useState([]),[L,k]=g.useState(!1),[V,M]=g.useState("");g.useEffect(()=>{if(l&&r){const s=r.items.map(D=>({...D,received:!1,receivedQuantity:0,notes:""}));v(s);const m=new Date().getTime().toString().slice(-6);M(`GRN-${r.id.replace("PO-","")}-${m}`),b.setFieldsValue({receivedBy:void 0,checkedBy:void 0,notes:"",receivedDate:new Date().toISOString().split("T")[0]})}},[l,r,b]);const G=(s,m,D)=>{v(t=>t.map(n=>n.itemId===s&&n.type===m?{...n,received:D,receivedQuantity:D?n.quantity:0}:n))},i=(s,m,D)=>{v(t=>t.map(n=>n.itemId===s&&n.type===m?{...n,receivedQuantity:D,received:D>0}:n))},I=(s,m,D)=>{v(t=>t.map(n=>n.itemId===s&&n.type===m?{...n,notes:D}:n))},U=async()=>{try{A(!0);const s=await b.validateFields();if(!S.some(d=>d.received)){u.error("Please mark at least one item as received"),A(!1);return}const D={id:V,purchaseOrderId:r.id,vendorName:r.vendorName,vendorId:r.vendorId,receivedDate:s.receivedDate,receivedBy:s.receivedBy,checkedBy:s.checkedBy,notes:s.notes,items:S.filter(d=>d.received),timestamp:new Date},t=S.filter(d=>d.received&&d.type==="product"&&d.receivedQuantity>0).map(d=>({id:d.itemId,quantity:d.receivedQuantity})),n=S.filter(d=>d.received&&d.type==="material"&&d.receivedQuantity>0).map(d=>({id:d.itemId,quantity:d.receivedQuantity}));p&&p(t,n),c&&c(r.id,D),u.success("Goods received successfully"),k(!0),setTimeout(()=>{B()},0)}catch(s){console.error("Error submitting GRN:",s),u.error("Please fill in all required fields")}finally{A(!1)}},B=async()=>{try{const s=document.getElementById("grn-pdf");if(!s){console.error("PDF element not found"),k(!1);return}const m=await Se(s,{scale:2,useCORS:!0,allowTaint:!0,backgroundColor:"#ffffff",width:s.scrollWidth,height:s.scrollHeight}),D=210,t=295,n=m.height*D/m.width;let d=n;const f=new Ie("p","mm","a4");let N=0;for(f.addImage(m.toDataURL("image/png"),"PNG",0,N,D,n),d-=t;d>=0;)N=d-n,f.addPage(),f.addImage(m.toDataURL("image/png"),"PNG",0,N,D,n),d-=t;const y=`goods-receive-note-${V}.pdf`;f.save(y),u.success("Goods Receive Note PDF downloaded successfully")}catch(s){console.error("Error generating PDF:",s),u.error("Failed to generate PDF"),k(!1)}},ie=[{title:"",key:"received",width:50,render:s=>e.jsx($e,{checked:s.received,onChange:m=>G(s.itemId,s.type,m.target.checked)})},{title:"Type",dataIndex:"type",key:"type",width:100,render:s=>e.jsx(ne,{color:s==="product"?"blue":"green",children:s==="product"?"Product":"Material"})},{title:"Item",key:"name",render:s=>e.jsxs("div",{children:[e.jsx(ae,{strong:!0,children:s.name}),e.jsx("br",{}),e.jsxs(ae,{type:"secondary",className:"text-xs",children:["SKU: ",s.sku," | ",s.category]})]})},{title:"Ordered",dataIndex:"quantity",key:"quantity",width:100,render:(s,m)=>e.jsxs(ae,{children:[s," ",m.unit||"units"]})},{title:"Received",key:"receivedQuantity",width:120,render:s=>e.jsx(we,{min:0,max:s.quantity,value:s.receivedQuantity,onChange:m=>i(s.itemId,s.type,m),disabled:!s.received,className:"w-full"})},{title:"Notes",key:"notes",width:200,render:s=>e.jsx(H,{placeholder:"Add notes",value:s.notes,onChange:m=>I(s.itemId,s.type,m.target.value),disabled:!s.received})}];return r?e.jsxs(e.Fragment,{children:[e.jsx(ue,{title:e.jsxs(X,{children:[e.jsx(O,{name:"inventory",className:"text-green-600"}),e.jsxs("span",{children:["Goods Receive Note - ",r.id]})]}),open:l&&!L,onCancel:x,width:1e3,footer:[e.jsx(T,{onClick:x,children:"Cancel"},"cancel"),e.jsx(T,{onClick:()=>k(!0),icon:e.jsx(O,{name:"visibility"}),children:"Preview GRN"},"view"),e.jsx(T,{type:"primary",onClick:U,loading:j,className:"bg-green-600",children:"Confirm & Generate GRN"},"submit")],children:e.jsxs("div",{className:"space-y-6",children:[e.jsx(Ae,{message:"Goods Receiving Process",description:"Check the items you've received, enter the received quantity, and add any notes. This will update your inventory and generate a Goods Receive Note (GRN).",type:"info",showIcon:!0,className:"mb-6"}),e.jsx(ge,{size:"small",className:"mb-4",children:e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("div",{children:[e.jsx(ae,{strong:!0,children:"GRN Number:"})," ",V]}),e.jsxs("div",{children:[e.jsx(ae,{strong:!0,children:"PO Number:"})," ",r.id]}),e.jsxs("div",{children:[e.jsx(ae,{strong:!0,children:"Vendor:"})," ",r.vendorName]})]})}),e.jsxs(h,{form:b,layout:"vertical",children:[e.jsxs(ce,{gutter:16,children:[e.jsx(_,{span:8,children:e.jsx(h.Item,{name:"receivedDate",label:"Date Received",rules:[{required:!0,message:"Please enter receive date"}],children:e.jsx(H,{type:"date"})})}),e.jsx(_,{span:8,children:e.jsx(h.Item,{name:"receivedBy",label:"Received By (Select User)",rules:[{required:!0,message:"Please enter receiver name"}],children:e.jsx(z,{placeholder:"Select receiver",showSearch:!0,filterOption:(s,m)=>m.children.toLowerCase().includes(s.toLowerCase()),children:R.filter(s=>s.isActive).map(s=>e.jsxs(Option,{value:`${s.firstName} ${s.lastName}`,children:[s.firstName," ",s.lastName," (",s.role,")"]},s.id))})})}),e.jsx(_,{span:8,children:e.jsx(h.Item,{name:"checkedBy",label:"Checked By (Select User)",rules:[{required:!0,message:"Please enter checker name"}],children:e.jsx(z,{placeholder:"Select checker",showSearch:!0,filterOption:(s,m)=>m.children.toLowerCase().includes(s.toLowerCase()),children:R.filter(s=>s.isActive).map(s=>e.jsxs(Option,{value:`${s.firstName} ${s.lastName}`,children:[s.firstName," ",s.lastName," (",s.role,")"]},s.id))})})})]}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx(st,{level:5,className:"m-0",children:"Items Received"}),e.jsxs(X,{children:[e.jsx(T,{size:"small",onClick:()=>{v(s=>s.map(m=>({...m,received:!0,receivedQuantity:m.quantity})))},children:"Select All"}),e.jsx(T,{size:"small",onClick:()=>{v(s=>s.map(m=>({...m,received:!1,receivedQuantity:0})))},children:"Clear All"})]})]}),e.jsx(W,{columns:ie,dataSource:S,rowKey:s=>`${s.type}-${s.itemId}`,pagination:!1,rowClassName:s=>s.received?"bg-green-50":""})]}),e.jsx(h.Item,{name:"notes",label:"Additional Notes",children:e.jsx(at,{rows:3,placeholder:"Enter any additional notes about this delivery"})})]}),e.jsx("div",{className:"bg-gray-50 p-4 rounded-lg",children:e.jsxs(ae,{className:"text-sm",children:[e.jsx(O,{name:"info",className:"mr-2 text-blue-600"}),e.jsx("strong",{children:"Note:"}),' Completing this form will update your inventory with the received items and change the purchase order status to "completed".']})})]})}),e.jsx(ue,{title:e.jsxs(X,{children:[e.jsx(O,{name:"inventory",className:"text-green-600"}),e.jsx("span",{children:"Goods Receive Note Preview"})]}),open:L,onCancel:()=>k(!1),width:1e3,footer:[e.jsx(T,{onClick:()=>k(!1),children:"Close"},"close"),e.jsx(T,{type:"primary",onClick:B,icon:e.jsx(O,{name:"download"}),className:"bg-green-600",children:"Download PDF"},"download")],children:e.jsx("div",{className:"max-h-[70vh] overflow-y-auto",children:e.jsx(tt,{order:r,grnData:{id:V,receivedDate:b.getFieldValue("receivedDate"),receivedBy:b.getFieldValue("receivedBy"),checkedBy:b.getFieldValue("checkedBy"),notes:b.getFieldValue("notes"),items:S.filter(s=>s.received)},id:"grn-pdf"})})})]}):null}const{Title:Re,Text:Q}=le;function nt({open:l,onClose:x,order:r,onStatusChange:c,onEdit:p,onUpdateInventory:R}){const[b,j]=g.useState(!1),[A,S]=g.useState(!1),[v,L]=g.useState(!1),[k,V]=g.useState(null),[M,G]=g.useState(!1);if(!r)return null;const i=t=>{c(r.id,t)},I=async()=>{G(!0),S(!0),setTimeout(async()=>{try{const t=document.getElementById("purchase-order-pdf");if(!t){u.error("PDF element not found"),j(!1);return}const n=await Se(t,{scale:2,useCORS:!0,allowTaint:!0,backgroundColor:"#ffffff",width:t.scrollWidth,height:t.scrollHeight}),d=210,f=295,N=n.height*d/n.width;let y=N;const C=new Ie("p","mm","a4");let $=0;for(C.addImage(n.toDataURL("image/png"),"PNG",0,$,d,N),y-=f;y>=0;)$=y-N,C.addPage(),C.addImage(n.toDataURL("image/png"),"PNG",0,$,d,N),y-=f;const Y=`purchase-order-${r.id}.pdf`;C.save(Y),u.success("Purchase order PDF downloaded successfully")}catch(t){console.error("Error generating PDF:",t),u.error("Failed to generate PDF: "+t.message)}finally{G(!1),S(!1)}},500)},U=()=>{L(!0)},B=(t,n)=>{const f=n.items.every(N=>N.receivedQuantity>=N.quantity)?"completed":"received";c(t,f),V(n),L(!1),u.success(`Goods received successfully. Order status updated to ${f}.`)},ie=async()=>{if(!k){u.error("No GRN data available. Please complete the order first.");return}j(!0);try{const t=document.createElement("div");t.style.position="absolute",t.style.left="-9999px",t.id="temp-grn-pdf",document.body.appendChild(t),Ge(t).render(e.jsx(GoodsReceiveNotePDF,{order:r,grnData:k,id:"temp-grn-pdf-content"})),await new Promise(ve=>setTimeout(ve,100));const d=document.getElementById("temp-grn-pdf-content");if(!d)throw new Error("GRN PDF element not found");const f=await Se(d,{scale:2,useCORS:!0,allowTaint:!0,backgroundColor:"#ffffff",width:d.scrollWidth,height:d.scrollHeight}),N=210,y=295,C=f.height*N/f.width;let $=C;const Y=new Ie("p","mm","a4");let me=0;for(Y.addImage(f.toDataURL("image/png"),"PNG",0,me,N,C),$-=y;$>=0;)me=$-C,Y.addPage(),Y.addImage(f.toDataURL("image/png"),"PNG",0,me,N,C),$-=y;const je=`goods-receive-note-${k.id}.pdf`;Y.save(je),u.success("Goods Receive Note PDF downloaded successfully"),document.body.removeChild(t)}catch(t){console.error("Error generating GRN PDF:",t),u.error("Failed to generate GRN PDF")}finally{j(!1)}},s=t=>({pending:0,received:1,completed:1})[t]||0,m=[{key:"pending",label:"Pending Approval"},{key:"completed",label:"Completed"}],D=[{title:"Type",dataIndex:"type",key:"type",width:100,render:t=>e.jsx(ne,{color:t==="product"?"blue":"green",children:t==="product"?"Product":"Material"})},{title:"Name",dataIndex:"name",key:"name",render:(t,n)=>e.jsxs("div",{children:[e.jsx(Q,{strong:!0,children:t}),e.jsx("br",{}),e.jsxs(Q,{type:"secondary",className:"text-xs",children:["SKU: ",n.sku," | ",n.category]})]})},{title:"Quantity",key:"quantity",width:120,render:t=>e.jsxs(Q,{children:[t.quantity," ",t.unit||"units"]})},{title:"Unit Price",dataIndex:"unitPrice",key:"unitPrice",width:120,render:t=>e.jsxs(Q,{children:["LKR ",t.toFixed(2)]})},{title:"Total",dataIndex:"total",key:"total",width:120,render:t=>e.jsxs(Q,{strong:!0,children:["LKR ",t.toFixed(2)]})}];return m.filter(t=>(s(r.status),s(t.key),r.status==="completed"?!1:t.key==="completed")).map(t=>({key:t.key,label:t.label,onClick:()=>i(t.key)})),e.jsxs(e.Fragment,{children:[e.jsx(ue,{title:e.jsxs(X,{children:[e.jsx(O,{name:"shopping_cart",className:"text-blue-600"}),e.jsxs("span",{children:["Purchase Order Details - ",r.id]})]}),open:l,onCancel:x,width:900,footer:[e.jsx(T,{onClick:x,children:"Close"},"close"),(r.status==="completed"||r.status==="received")&&e.jsx(T,{onClick:ie,icon:e.jsx(O,{name:"download"}),loading:b&&!A,children:"Download GRN"},"download-grn"),(r.status==="pending"||r.status==="received")&&e.jsx(T,{onClick:U,icon:e.jsx(O,{name:"inventory"}),type:"primary",className:"bg-green-600",children:r.status==="received"?"Update Received Items":"Complete Order"},"receive"),r.status==="pending"&&e.jsx(T,{onClick:p,icon:e.jsx(O,{name:"edit"}),children:"Edit"},"edit"),e.jsx(T,{type:"primary",onClick:()=>{I()},loading:M,icon:e.jsx(O,{name:"download"}),className:"bg-blue-600",children:"Purchase Order"},"download")],children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("div",{children:[e.jsx(Q,{type:"secondary",children:"Status"}),e.jsx("br",{}),e.jsx(ne,{color:r.status==="completed"?"green":r.status==="pending"?"blue":"default",className:"text-base px-3 py-1 mt-1 capitalize",children:r.status})]}),e.jsxs("div",{className:"text-right",children:[e.jsx(Q,{type:"secondary",children:"Created By"}),e.jsx("br",{}),e.jsx(Q,{strong:!0,children:r.createdBy})]})]}),e.jsx(_e,{current:s(r.status),size:"small",items:r.status==="received"?[{title:"Pending",description:"Order created"},{title:"Received",description:"Partially received"},{title:"Completed",description:"Fully received"}]:[{title:"Pending",description:"Order created"},{title:"Completed",description:"Order fulfilled"}]})]}),e.jsxs(K,{title:"Vendor Information",bordered:!0,size:"small",column:2,children:[e.jsx(K.Item,{label:"Vendor Name",span:2,children:r.vendorName}),e.jsx(K.Item,{label:"Email",children:r.vendorEmail||"N/A"}),e.jsx(K.Item,{label:"Phone",children:r.vendorPhone||"N/A"}),e.jsx(K.Item,{label:"Address",span:2,children:r.vendorAddress||"N/A"})]}),e.jsxs(K,{title:"Order Information",bordered:!0,size:"small",column:2,children:[e.jsx(K.Item,{label:"Order Date",children:new Date(r.orderDate).toLocaleDateString()}),e.jsx(K.Item,{label:"Expected Delivery",children:r.expectedDeliveryDate?new Date(r.expectedDeliveryDate).toLocaleDateString():"Not specified"}),e.jsx(K.Item,{label:"Payment Terms",children:r.paymentTerms||"Not specified"}),e.jsx(K.Item,{label:"Shipping Method",children:r.shippingMethod||"Not specified"}),e.jsx(K.Item,{label:"Ship To Address",span:2,children:r.shippingAddress}),r.notes&&e.jsx(K.Item,{label:"Notes",span:2,children:r.notes})]}),e.jsxs("div",{children:[e.jsx(Re,{level:5,className:"mb-4",children:"Order Items"}),e.jsx(W,{columns:D,dataSource:r.items,rowKey:t=>`${t.type}-${t.itemId}`,pagination:!1,summary:()=>e.jsxs(W.Summary.Row,{children:[e.jsx(W.Summary.Cell,{index:0,colSpan:4,children:e.jsx(Q,{strong:!0,children:"Total"})}),e.jsx(W.Summary.Cell,{index:1,children:e.jsxs(Q,{strong:!0,className:"text-blue-600",children:["LKR ",r.total.toFixed(2)]})})]})})]}),r.timeline&&r.timeline.length>0&&e.jsxs("div",{children:[e.jsx(Re,{level:5,className:"mb-4",children:"Order Timeline"}),e.jsx(qe,{items:r.timeline.map(t=>({color:t.status==="completed"?"green":t.status==="cancelled"?"red":t.status==="approved"?"purple":t.status==="ordered"?"orange":t.status==="received"?"green":t.status==="pending"?"blue":"gray",children:e.jsxs("div",{children:[e.jsx(Q,{strong:!0,children:t.status.charAt(0).toUpperCase()+t.status.slice(1)}),e.jsx("br",{}),e.jsxs(Q,{type:"secondary",className:"text-sm",children:[new Date(t.timestamp).toLocaleString()," - ",t.user]}),t.notes&&e.jsx("div",{className:"mt-1 text-sm",children:t.notes})]})}))})]})]})}),e.jsx(rt,{open:v,onClose:()=>L(!1),order:r,onComplete:B,onUpdateInventory:R}),A&&e.jsx("div",{style:{position:"absolute",left:"-9999px"},children:e.jsx(et,{order:r,id:"purchase-order-pdf"})})]})}const{Title:lt,Text:xe}=le,{TextArea:it}=H,{Option:te}=z;function dt(){const l=Ee(),x=oe(i=>i.vendors.vendorsList),r=oe(i=>i.vendors.loading),[c,p]=g.useState(""),[R,b]=g.useState(!1),[j,A]=g.useState(null),[S]=h.useForm();g.useEffect(()=>{l(Be())},[l]);const v=x.filter(i=>i.name.toLowerCase().includes(c.toLowerCase())||i.email.toLowerCase().includes(c.toLowerCase())||i.category.toLowerCase().includes(c.toLowerCase())),L=()=>{S.validateFields().then(i=>{if(j){const I={...j,...i};l(Pe(I)),u.success("Vendor updated successfully")}else{const I={id:`V${String(x.length+1).padStart(3,"0")}`,...i,isActive:!0};l(Je(I)),u.success("Vendor added successfully")}b(!1),S.resetFields(),A(null)}).catch(i=>{console.log("Validate Failed:",i)})},k=i=>{A(i),S.setFieldsValue(i),b(!0)},V=i=>{l(Ue({id:i})),u.success("Vendor deleted successfully")},M=i=>{const I={...i,isActive:!i.isActive};l(Pe(I)),u.success(`Vendor ${i.isActive?"deactivated":"activated"} successfully`)},G=[{title:"Vendor Name",dataIndex:"name",key:"name",render:(i,I)=>e.jsxs("div",{children:[e.jsx(xe,{strong:!0,children:i}),e.jsx("br",{}),e.jsxs(xe,{type:"secondary",className:"text-xs",children:["ID: ",I.id]})]}),sorter:(i,I)=>i.name.localeCompare(I.name)},{title:"Category",dataIndex:"category",key:"category",render:i=>e.jsx(ne,{color:"blue",children:i}),filters:[...new Set(x.map(i=>i.category))].map(i=>({text:i,value:i})),onFilter:(i,I)=>I.category===i},{title:"Contact",key:"contact",render:i=>e.jsxs("div",{children:[e.jsx(xe,{children:i.email}),e.jsx("br",{}),e.jsx(xe,{type:"secondary",children:i.phone})]})},{title:"Address",dataIndex:"address",key:"address",ellipsis:!0},{title:"Status",key:"status",render:i=>e.jsx("div",{className:`relative inline-block w-10 h-5 rounded-full transition-colors duration-200 ease-in-out ${i.isActive?"bg-blue-600":"bg-gray-300"}`,onClick:()=>M(i),children:e.jsx("span",{className:`absolute left-0.5 top-0.5 bg-white w-4 h-4 rounded-full transition-transform duration-200 ease-in-out ${i.isActive?"transform translate-x-5":""}`})}),filters:[{text:"Active",value:!0},{text:"Inactive",value:!1}],onFilter:(i,I)=>I.isActive===i},{title:"Actions",key:"actions",render:i=>e.jsxs(X,{children:[e.jsx(he,{title:"Edit",children:e.jsx(re.Text,{icon:"edit",onClick:()=>k(i),className:"text-blue-600"})}),e.jsx(he,{title:"Delete",children:e.jsx(Ce,{title:"Delete this vendor?",onConfirm:()=>V(i.id),okText:"Delete",cancelText:"Cancel",okButtonProps:{danger:!0},children:e.jsx(re.Text,{icon:"delete",danger:!0})})})]})}];return e.jsxs(ge,{children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx(lt,{level:5,className:"m-0",children:"Vendor Management"}),e.jsxs(X,{children:[e.jsx(Me,{placeholder:"Search vendors...",value:c,onSearch:p,className:"w-64"}),e.jsx(re.Primary,{icon:"add",onClick:()=>{A(null),S.resetFields(),b(!0)},children:"Add Vendor"})]})]}),e.jsx(W,{columns:G,dataSource:v,rowKey:"id",loading:r,pagination:{pageSize:10,showSizeChanger:!0,showQuickJumper:!0}}),e.jsx(ue,{title:j?"Edit Vendor":"Add New Vendor",open:R,onCancel:()=>{b(!1),A(null),S.resetFields()},footer:[e.jsx(T,{onClick:()=>{b(!1),A(null),S.resetFields()},children:"Cancel"},"cancel"),e.jsx(T,{type:"primary",onClick:L,children:j?"Update":"Add"},"submit")],children:e.jsxs(h,{form:S,layout:"vertical",children:[e.jsx(h.Item,{name:"name",label:"Vendor Name",rules:[{required:!0,message:"Please enter vendor name"}],children:e.jsx(H,{placeholder:"Enter vendor name"})}),e.jsx(h.Item,{name:"category",label:"Category",rules:[{required:!0,message:"Please enter category"}],children:e.jsxs(z,{placeholder:"Select category",children:[e.jsx(te,{value:"Wood",children:"Wood"}),e.jsx(te,{value:"Hardware",children:"Hardware"}),e.jsx(te,{value:"Upholstery",children:"Upholstery"}),e.jsx(te,{value:"Finishing",children:"Finishing"}),e.jsx(te,{value:"Metal",children:"Metal"}),e.jsx(te,{value:"Fabric",children:"Fabric"}),e.jsx(te,{value:"Materials",children:"Materials"}),e.jsx(te,{value:"Other",children:"Other"})]})}),e.jsx(h.Item,{name:"email",label:"Email",rules:[{type:"email",message:"Please enter a valid email"},{required:!0,message:"Please enter email"}],children:e.jsx(H,{placeholder:"Enter email address"})}),e.jsx(h.Item,{name:"phone",label:"Phone",children:e.jsx(H,{placeholder:"Enter phone number"})}),e.jsx(h.Item,{name:"address",label:"Address",children:e.jsx(it,{rows:3,placeholder:"Enter address"})})]})})]})}const{Title:pt,Text:se}=le,{Option:fe}=z,{Search:gt}=H,{TabPane:jt}=pe;function vt(){const l=Ee(),x=oe(a=>a.purchaseOrders.purchaseOrdersList),r=oe(a=>a.purchaseOrders.loading),c=oe(a=>a.products.productsList),p=oe(a=>a.rawMaterials.rawMaterialsList),{currentUser:R,hasPermission:b,logAction:j}=Fe(),[A,S]=g.useState(""),[v,L]=g.useState("all"),[k,V]=g.useState(null),[M,G]=g.useState(!1),[i,I]=g.useState(!1),[U,B]=g.useState(null),[ie,s]=g.useState([]),[m,D]=g.useState("orders");g.useEffect(()=>{l(Ke()),l(Qe()),l(ze())},[l]);const t=x.filter(a=>{const o=a.id?.toLowerCase().includes(A.toLowerCase())||a.vendorName?.toLowerCase().includes(A.toLowerCase())||a.createdBy?.toLowerCase().includes(A.toLowerCase()),w=v==="all"||a.status===v;let E=!0;if(k&&k.length===2){const J=new Date(a.orderDate),Le=k[0].startOf("day").toDate(),Ve=k[1].endOf("day").toDate();E=J>=Le&&J<=Ve}return o&&w&&E}),n=a=>{const o={...a,id:`PO-${Date.now()}`,createdBy:`${R.firstName} ${R.lastName}`,createdAt:new Date,status:"pending",timeline:[{status:"pending",timestamp:new Date,user:`${R.firstName} ${R.lastName}`,notes:"Purchase order created and pending"}]};return l(Xe(o)),j&&j("CREATE","purchase-orders",`Created purchase order: ${o.id}`,{orderId:o.id,total:o.total}),u.success("Purchase order created successfully"),o},d=(a,o)=>{const w=x.find(J=>J.id===a);if(!w)return u.error("Purchase order not found"),null;const E={...w,...o,updatedAt:new Date};return l(ke(E)),j&&j("UPDATE","purchase-orders",`Updated purchase order: ${E.id}`,{orderId:E.id}),u.success("Purchase order updated successfully"),E},f=a=>{l(Te({id:a})),j&&j("DELETE","purchase-orders",`Deleted purchase order: ${a}`,{orderId:a}),u.success("Purchase order deleted successfully")},N=a=>{a.forEach(o=>{l(Te({id:o})),j&&j("DELETE","purchase-orders",`Deleted purchase order: ${o}`,{orderId:o})}),u.success(`${a.length} purchase orders deleted successfully`),s([])},y=(a,o)=>{const w=x.find(J=>J.id===a);if(!w)return;const E={...w,status:o,updatedAt:new Date,timeline:[...w.timeline||[],{status:o,timestamp:new Date,user:`${R.firstName} ${R.lastName}`,notes:`Status changed to ${o}`}]};l(ke(E)),j&&j("UPDATE","purchase-orders",`Updated purchase order status: ${a} to ${o}`,{orderId:a,status:o}),u.success(`Purchase order status updated to ${o}`),U&&U.id===a&&B(E)},C=(a,o)=>{a.forEach(w=>{l({type:"RESTORE_PRODUCT_STOCK",payload:{productId:w.id,quantity:w.quantity}}),j&&j("UPDATE","products",`Updated product stock from PO: ${w.id} (+${w.quantity} units)`,{productId:w.id,quantity:w.quantity})}),o.forEach(w=>{const E=p.find(J=>J.id===w.id);E&&(l({type:"UPDATE_RAW_MATERIAL",payload:{...E,stockQuantity:E.stockQuantity+w.quantity}}),j&&j("UPDATE","raw-materials",`Updated raw material stock from PO: ${w.id} (+${w.quantity} ${E.unit})`,{materialId:w.id,quantity:w.quantity}))}),u.success("Inventory updated successfully")},$=a=>{B(a),I(!0)},Y=a=>{switch(a){case"pending":return"blue";case"completed":return"green";default:return"default"}},me=[{title:"PO Number",dataIndex:"id",key:"id",width:150,render:a=>e.jsx(se,{strong:!0,children:a}),sorter:(a,o)=>a.id.localeCompare(o.id)},{title:"Vendor",dataIndex:"vendorName",key:"vendorName",width:200,render:(a,o)=>e.jsxs("div",{children:[e.jsx(se,{strong:!0,children:a}),e.jsx("br",{}),e.jsx(se,{type:"secondary",className:"text-xs",children:o.vendorEmail})]}),sorter:(a,o)=>a.vendorName.localeCompare(o.vendorName)},{title:"Order Date",dataIndex:"orderDate",key:"orderDate",width:120,render:a=>e.jsx(se,{children:new Date(a).toLocaleDateString()}),sorter:(a,o)=>new Date(a.orderDate)-new Date(o.orderDate)},{title:"Expected Delivery",dataIndex:"expectedDeliveryDate",key:"expectedDeliveryDate",width:150,render:a=>a?e.jsx(se,{children:new Date(a).toLocaleDateString()}):e.jsx(se,{type:"secondary",children:"Not specified"}),sorter:(a,o)=>a.expectedDeliveryDate?o.expectedDeliveryDate?new Date(a.expectedDeliveryDate)-new Date(o.expectedDeliveryDate):-1:1},{title:"Items",key:"items",width:100,render:a=>{const o=a.items.length,w=a.items.filter(J=>J.type==="product").length,E=a.items.filter(J=>J.type==="material").length;return e.jsxs("div",{children:[e.jsxs(ne,{color:"blue",children:[o," items"]}),e.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:[w>0&&e.jsxs("span",{className:"mr-2",children:[w," products"]}),E>0&&e.jsxs("span",{children:[E," materials"]})]})]})}},{title:"Total",dataIndex:"total",key:"total",width:120,render:a=>e.jsxs(se,{strong:!0,className:"text-blue-600",children:["LKR ",a.toFixed(2)]}),sorter:(a,o)=>a.total-o.total},{title:"Status",dataIndex:"status",key:"status",width:120,render:a=>e.jsx(ne,{color:Y(a),className:"capitalize",children:a}),filters:[{text:"Pending",value:"pending"},{text:"Completed",value:"completed"}],onFilter:(a,o)=>o.status===a},{title:"Created By",dataIndex:"createdBy",key:"createdBy",width:150,render:a=>e.jsx(se,{children:a})},{title:"Actions",key:"actions",fixed:"right",width:120,render:a=>e.jsxs(X,{children:[e.jsx(he,{title:"View Details",children:e.jsx(re.Text,{icon:"visibility",onClick:o=>{o.stopPropagation(),$(a)},className:"text-blue-600"})}),a.status==="pending"&&e.jsx(he,{title:"Edit",children:e.jsx(re.Text,{icon:"edit",onClick:o=>{o.stopPropagation(),B(a),G(!0)},className:"text-gray-600"})}),a.status!=="completed"&&e.jsx(he,{title:"Delete",children:e.jsx(Ce,{title:"Delete this purchase order?",onConfirm:o=>{o?.stopPropagation(),f(a.id)},okText:"Delete",cancelText:"Cancel",okButtonProps:{danger:!0},children:e.jsx(re.Text,{icon:"delete",danger:!0,onClick:o=>o.stopPropagation()})})})]})}],je=()=>r?e.jsx(He,{type:"table"}):e.jsx(We,{title:"Purchase Orders",icon:"shopping_cart",columns:me,dataSource:t,rowKey:"id",rowSelection:{type:"checkbox",onChange:a=>s(a),getCheckboxProps:a=>({disabled:a.status==="completed"||a.status==="cancelled"})},onDelete:N,onRow:a=>({onClick:()=>$(a),className:"cursor-pointer hover:bg-blue-50"}),searchFields:["id","vendorName","createdBy"],searchPlaceholder:"Search purchase orders...",extra:e.jsxs(X,{children:[e.jsxs(z,{value:v,onChange:L,className:"w-32",children:[e.jsx(fe,{value:"all",children:"All Status"}),e.jsx(fe,{value:"pending",children:"Pending"}),e.jsx(fe,{value:"completed",children:"Completed"})]}),e.jsx(Ne.RangePicker,{value:k,onChange:V,placeholder:["Start Date","End Date"]}),e.jsx(re.Primary,{icon:"add",onClick:()=>{B(null),G(!0)},children:"Create Order"})]}),emptyDescription:"No purchase orders found",emptyImage:e.jsx(O,{name:"shopping_cart",className:"text-6xl text-gray-300"})}),ve=[{key:"orders",label:e.jsxs("span",{className:"flex items-center space-x-2",children:[e.jsx(O,{name:"shopping_cart"}),e.jsx("span",{children:"Purchase Orders"})]}),children:je()},{key:"vendors",label:e.jsxs("span",{className:"flex items-center space-x-2",children:[e.jsx(O,{name:"store"}),e.jsx("span",{children:"Vendors"})]}),children:e.jsx(dt,{})}];return e.jsxs(e.Fragment,{children:[e.jsx(ge,{children:e.jsx(pe,{activeKey:m,onChange:D,items:ve})}),e.jsx(Ze,{open:M,onClose:()=>{G(!1),B(null)},onSubmit:U?a=>d(U.id,a):n,editingOrder:U,products:c,rawMaterials:p}),e.jsx(nt,{open:i,onClose:()=>{I(!1),B(null)},order:U,onStatusChange:y,onUpdateInventory:C,onEdit:()=>{I(!1),G(!0)}})]})}export{vt as PurchaseOrderManagement};
