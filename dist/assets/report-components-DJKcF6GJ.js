import{u as ke,a as S,r as x,j as t,v as K,T as fe,f as m,O as we,S as b,b as h,K as M,N as ve,g as Se,R as _,C as R,V as be,d as k,P as A,B as T}from"./react-core-BYkUdBdl.js";import{k as Ce,f as Ne,b as Le,M as Re,m as Te,c as Ie,I as o,L as Pe,N as Me,O as z,A as I,v as P}from"./index-CNNU94z7.js";import{d as p}from"./date-utils-DpdzE7my.js";import"./utility-libs-C6oKIWOz.js";import"./pdf-utils-Bnf-IKEy.js";import"./react-state-DIKZUrF8.js";const{Title:B,Text:a}=fe,{RangePicker:V}=ve,{Option:l}=M;function Be(){const y=ke(),{rawMaterialsList:d,loading:W}=S(e=>e.rawMaterials),{productsList:j,loading:U}=S(e=>e.products),{transactionsList:q,loading:G}=S(e=>e.transactions),{couponsList:H,loading:J}=S(e=>e.coupons),{categoriesList:X,loading:Y}=S(e=>e.categories);Ce();const[Z,n]=x.useState(!1),[$,c]=x.useState("comprehensive"),[u,O]=x.useState("all"),[f,D]=x.useState(null),[ee,te]=x.useState("dashboard"),[i,Oe]=x.useState(""),[De,C]=x.useState([]);x.useEffect(()=>{y(Ne()),y(Le()),y(Re()),y(Te()),y(Ie())},[y]);const se=W||U||G||J||Y,w=(()=>{let e=[...q||[]];if(u==="today"){const s=p().startOf("day");e=e.filter(r=>p(r.timestamp).isAfter(s))}else if(u==="week"){const s=p().startOf("week");e=e.filter(r=>p(r.timestamp).isAfter(s))}else if(u==="month"){const s=p().startOf("month");e=e.filter(r=>p(r.timestamp).isAfter(s))}else u==="custom"&&f&&(e=e.filter(s=>{const r=p(s.timestamp);return r.isAfter(f[0].startOf("day"))&&r.isBefore(f[1].endOf("day"))}));return i&&(e=e.filter(s=>s.id.toLowerCase().includes(i.toLowerCase())||s.customerName?.toLowerCase().includes(i.toLowerCase())||s.cashier.toLowerCase().includes(i.toLowerCase())||s.salesperson?.toLowerCase().includes(i.toLowerCase()))),e})(),F=w.reduce((e,s)=>e+s.total,0),N=w.length,re=(j||[]).length,ae=(d||[]).length,oe=N>0?F/N:0,ne=(d||[]).reduce((e,s)=>e+s.stockQuantity*s.unitPrice,0),Q=(d||[]).filter(e=>e.stockQuantity<=e.minimumStock),E=(d||[]).filter(e=>e.stockQuantity===0),ce=(j||[]).filter(e=>e.stock<=10&&e.stock>0),ie=(j||[]).filter(e=>e.stock===0),v={};w.forEach(e=>{e.items.forEach(s=>{const r=s.product.id;v[r]||(v[r]={product:s.product,soldQuantity:0,revenue:0}),v[r].soldQuantity+=s.quantity,v[r].revenue+=s.product.price*s.quantity})});const L=Object.values(v).sort((e,s)=>s.soldQuantity-e.soldQuantity).slice(0,5),le=[{title:"Total Revenue",value:F,precision:2,prefix:"LKR ",icon:"attach_money",color:"#52c41a",change:"+12.5%"},{title:"Total Sales",value:N,icon:"shopping_cart",color:"#0E72BD",change:"+8.2%"},{title:"Furniture Items",value:re,icon:"inventory_2",color:"#722ed1",change:"+3.1%"},{title:"Raw Materials",value:ae,icon:"category",color:"#fa8c16",change:"+5.7%"},{title:"Average Order",value:oe,precision:2,prefix:"LKR ",icon:"trending_up",color:"#13c2c2",change:"+15.3%"},{title:"Material Inventory",value:ne,precision:2,prefix:"LKR ",icon:"warehouse",color:"#eb2f96",change:"+2.8%"}],de=[{key:"comprehensive",icon:t.jsx(o,{name:"analytics"}),label:"Comprehensive Report",onClick:()=>{c("comprehensive"),n(!0)}},{key:"products",icon:t.jsx(o,{name:"inventory_2"}),label:"Products Report",onClick:()=>{c("products"),n(!0)}},{key:"transactions",icon:t.jsx(o,{name:"receipt_long"}),label:"Transactions Report",onClick:()=>{c("transactions"),n(!0)}},{key:"transaction-items",icon:t.jsx(o,{name:"list_alt"}),label:"Transaction Items Report",onClick:()=>{c("transaction-items"),n(!0)}},{key:"raw-materials",icon:t.jsx(o,{name:"category"}),label:"Raw Materials Report",onClick:()=>{c("raw-materials"),n(!0)}},{key:"coupons",icon:t.jsx(o,{name:"local_offer"}),label:"Coupons Report",onClick:()=>{c("coupons"),n(!0)}}],ue=[{title:"Product",dataIndex:"name",key:"name",render:(e,s)=>t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsx(K,{src:s.image||"https://images.pexels.com/photos/586344/pexels-photo-586344.jpeg?auto=compress&cs=tinysrgb&w=100",alt:s.name,width:40,height:40,className:"object-cover rounded",preview:!1,style:{aspectRatio:"1/1",objectFit:"cover"}}),t.jsxs("div",{children:[t.jsx(a,{strong:!0,children:e}),t.jsx("br",{}),t.jsxs(a,{type:"secondary",className:"text-xs",children:["SKU: ",s.barcode]})]})]}),sorter:(e,s)=>e.name.localeCompare(s.name)},{title:"Category",dataIndex:"category",key:"category",render:e=>t.jsx(m,{color:"blue",children:e}),filters:[...new Set(j.map(e=>e.category))].map(e=>({text:e,value:e})),onFilter:(e,s)=>s.category===e},{title:"Price",dataIndex:"price",key:"price",render:e=>t.jsxs(a,{strong:!0,children:["LKR ",e.toFixed(2)]}),sorter:(e,s)=>e.price-s.price},{title:"Stock",dataIndex:"stock",key:"stock",render:e=>t.jsxs(m,{color:e>10?"green":e>0?"orange":"red",children:[e," units"]}),sorter:(e,s)=>e.stock-s.stock,filters:[{text:"In Stock (>10)",value:"in-stock"},{text:"Low Stock (1-10)",value:"low-stock"},{text:"Out of Stock",value:"out-of-stock"}],onFilter:(e,s)=>e==="in-stock"?s.stock>10:e==="low-stock"?s.stock>0&&s.stock<=10:e==="out-of-stock"?s.stock===0:!0},{title:"Total Value",key:"value",render:e=>t.jsxs(a,{children:["LKR ",(e.price*e.stock).toFixed(2)]}),sorter:(e,s)=>e.price*e.stock-s.price*s.stock}],xe=[{title:"Order ID",dataIndex:"id",key:"id",render:e=>t.jsx(a,{code:!0,children:e}),sorter:(e,s)=>e.id.localeCompare(s.id)},{title:"Date",dataIndex:"timestamp",key:"timestamp",render:e=>t.jsx(a,{children:new Date(e).toLocaleDateString()}),sorter:(e,s)=>new Date(e.timestamp)-new Date(s.timestamp),defaultSortOrder:"descend"},{title:"Customer",key:"customer",render:e=>t.jsx(a,{children:e.customerName||"Walk-in Customer"})},{title:"Items",dataIndex:"items",key:"items",render:e=>t.jsxs(m,{color:"blue",children:[e.length," items"]}),sorter:(e,s)=>e.items.length-s.items.length},{title:"Total",dataIndex:"total",key:"total",render:e=>t.jsxs(a,{strong:!0,className:"text-blue-600",children:["LKR ",e.toFixed(2)]}),sorter:(e,s)=>e.total-s.total},{title:"Status",dataIndex:"status",key:"status",render:e=>t.jsx(m,{color:e==="completed"?"green":e==="refunded"?"red":"orange",children:e.toUpperCase()}),filters:[{text:"Completed",value:"completed"},{text:"Refunded",value:"refunded"},{text:"Partially Refunded",value:"partially-refunded"}],onFilter:(e,s)=>s.status===e}],me=[{title:"Material",dataIndex:"name",key:"name",render:e=>t.jsx(a,{strong:!0,children:e}),sorter:(e,s)=>e.name.localeCompare(s.name)},{title:"Category",dataIndex:"category",key:"category",render:e=>t.jsx(m,{color:"blue",children:e}),filters:[...new Set(d.map(e=>e.category))].map(e=>({text:e,value:e})),onFilter:(e,s)=>s.category===e},{title:"Stock",key:"stock",render:e=>t.jsxs("div",{children:[t.jsxs(a,{strong:!0,children:[e.stockQuantity," ",e.unit]}),t.jsx("br",{}),t.jsxs(a,{type:"secondary",className:"text-xs",children:["Min: ",e.minimumStock," ",e.unit]})]}),sorter:(e,s)=>e.stockQuantity-s.stockQuantity},{title:"Status",key:"status",render:e=>{const s=e.stockQuantity===0,r=e.stockQuantity<=e.minimumStock;return t.jsx(m,{color:s?"red":r?"orange":"green",children:s?"Out of Stock":r?"Low Stock":"In Stock"})},filters:[{text:"In Stock",value:"in-stock"},{text:"Low Stock",value:"low-stock"},{text:"Out of Stock",value:"out-of-stock"}],onFilter:(e,s)=>{const r=s.stockQuantity===0,g=s.stockQuantity<=s.minimumStock;return e==="out-of-stock"?r:e==="low-stock"?g&&!r:e==="in-stock"?!g&&!r:!0}},{title:"Unit Price",dataIndex:"unitPrice",key:"unitPrice",render:e=>t.jsxs(a,{children:["LKR ",e.toFixed(2)]}),sorter:(e,s)=>e.unitPrice-s.unitPrice},{title:"Total Value",key:"value",render:e=>t.jsxs(a,{children:["LKR ",(e.stockQuantity*e.unitPrice).toFixed(2)]}),sorter:(e,s)=>e.stockQuantity*e.unitPrice-s.stockQuantity*s.unitPrice}],he=()=>t.jsxs(b,{direction:"vertical",size:"large",className:"w-full",children:[E.length>0&&t.jsx(z,{type:"error",title:"Critical Stock Alert",materials:E,products:ie}),Q.length>0&&t.jsx(z,{type:"warning",title:"Low Stock Warning",materials:Q,products:ce}),t.jsxs(h,{children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsxs("div",{className:"flex items-center",children:[t.jsx(o,{name:"analytics",className:"text-[#0E72BD] mr-2",size:"text-xl"}),t.jsxs("div",{children:[t.jsx(a,{strong:!0,className:"text-lg",children:"Furniture Store Analytics"}),t.jsx(a,{type:"secondary",className:"text-sm block",children:"Comprehensive business insights and reports"})]})]}),t.jsxs(b,{children:[t.jsxs(M,{value:u,onChange:O,className:"w-32",children:[t.jsx(l,{value:"all",children:"All Time"}),t.jsx(l,{value:"today",children:"Today"}),t.jsx(l,{value:"week",children:"This Week"}),t.jsx(l,{value:"month",children:"This Month"}),t.jsx(l,{value:"custom",children:"Custom Range"})]}),u==="custom"&&t.jsx(V,{value:f,onChange:D,placeholder:["Start Date","End Date"]}),t.jsx(Se,{menu:{items:de},trigger:["click"],children:t.jsx(I.Primary,{icon:"download",children:"Export Reports"})})]})]}),t.jsx(_,{gutter:[16,16],"data-tour":"stats-cards",children:le.map((e,s)=>t.jsx(R,{xs:24,sm:12,lg:8,xl:4,children:t.jsxs(h,{className:"text-center",children:[t.jsxs("div",{className:"flex items-center justify-between mb-2",children:[t.jsx("div",{className:"flex items-center justify-center w-10 h-10 rounded-lg text-white",style:{backgroundColor:e.color},children:t.jsx(o,{name:e.icon})}),t.jsx(m,{color:"green",className:"text-xs",children:e.change})]}),t.jsx(be,{title:e.title,value:e.value,precision:e.precision,prefix:e.prefix,valueStyle:{color:e.color,fontSize:"20px",fontWeight:"bold"}})]})},s))})]}),t.jsxs(_,{gutter:16,children:[t.jsx(R,{xs:24,lg:12,children:t.jsx(h,{title:t.jsxs(b,{children:[t.jsx(o,{name:"inventory_2",className:"text-blue-600"}),t.jsx(B,{level:5,className:"m-0",children:"Top Selling Furniture"})]}),extra:t.jsx(I.Text,{icon:"download",onClick:()=>{c("products"),n(!0)},children:"Export"}),children:L.length>0?t.jsx(k,{dataSource:L,renderItem:(e,s)=>t.jsx(k.Item,{children:t.jsx(k.Item.Meta,{avatar:t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsx("div",{className:"flex items-center justify-center w-8 h-8 bg-blue-600 text-white rounded-full text-sm font-bold",children:s+1}),t.jsx(K,{src:e.product.image||"https://images.pexels.com/photos/586344/pexels-photo-586344.jpeg?auto=compress&cs=tinysrgb&w=100",alt:e.product.name,width:40,height:40,className:"object-cover rounded",preview:!1,style:{aspectRatio:"1/1",objectFit:"cover"}})]}),title:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx(a,{strong:!0,children:e.product.name}),t.jsxs(a,{strong:!0,className:"text-blue-600",children:["LKR ",e.revenue.toFixed(2)]})]}),description:t.jsxs("div",{children:[t.jsx(a,{type:"secondary",children:e.product.category}),t.jsx("br",{}),t.jsxs(a,{type:"secondary",className:"text-xs",children:[e.soldQuantity," units sold"]}),t.jsx(A,{percent:Math.min(e.soldQuantity/(L[0]?.soldQuantity||1)*100,100),size:"small",showInfo:!1,className:"mt-1"})]})})})}):t.jsxs("div",{className:"text-center py-8",children:[t.jsx(o,{name:"inventory_2",className:"text-4xl text-gray-300 mb-2"}),t.jsx(a,{type:"secondary",children:"No sales data for selected period"})]})})}),t.jsx(R,{xs:24,lg:12,children:t.jsx(h,{title:t.jsxs(b,{children:[t.jsx(o,{name:"category",className:"text-blue-600"}),t.jsx(B,{level:5,className:"m-0",children:"Raw Material Status"})]}),extra:t.jsx(I.Text,{icon:"download",onClick:()=>{c("raw-materials"),n(!0)},children:"Export"}),children:t.jsx(k,{dataSource:d.slice(0,5),renderItem:e=>{const s=Math.min(e.stockQuantity/(e.minimumStock*3)*100,100),r=e.stockQuantity<=e.minimumStock,g=e.stockQuantity===0;return t.jsx(k.Item,{children:t.jsx(k.Item.Meta,{avatar:t.jsx("div",{className:"flex items-center justify-center w-8 h-8 bg-orange-500 text-white rounded",children:t.jsx(o,{name:"category"})}),title:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx(a,{strong:!0,children:e.name}),t.jsxs(a,{strong:!0,children:[e.stockQuantity," ",e.unit]})]}),description:t.jsxs("div",{children:[t.jsx(a,{type:"secondary",children:e.category}),t.jsx("br",{}),t.jsxs("div",{className:"flex items-center justify-between mt-1",children:[t.jsx(A,{percent:s,size:"small",status:g?"exception":r?"active":"normal",showInfo:!1,className:"flex-1 mr-2"}),t.jsx(m,{color:g?"red":r?"orange":"green",className:"text-xs",children:g?"Out of Stock":r?"Low Stock":"In Stock"})]})]})})})}})})})]})]}),pe=()=>t.jsx(h,{children:t.jsx(P,{title:"Product Reports",icon:"inventory_2",columns:ue,dataSource:j.filter(e=>e.name.toLowerCase().includes(i.toLowerCase())||e.category.toLowerCase().includes(i.toLowerCase())||e.barcode?.toLowerCase().includes(i.toLowerCase())),rowKey:"id",rowSelection:{type:"checkbox",onChange:e=>C(e)},searchFields:["name","category","barcode"],searchPlaceholder:"Search products...",showSearch:!0,extra:t.jsx(T,{type:"primary",icon:t.jsx(o,{name:"download"}),onClick:()=>{c("products"),n(!0)},children:"Export"}),emptyDescription:"No products found",emptyImage:t.jsx(o,{name:"inventory_2",className:"text-6xl text-gray-300"})})}),ye=()=>t.jsx(h,{children:t.jsx(P,{title:"Order Reports",icon:"receipt_long",columns:xe,dataSource:w,rowKey:"id",rowSelection:{type:"checkbox",onChange:e=>C(e)},searchFields:["id","customerName","cashier","salesperson"],searchPlaceholder:"Search orders...",showSearch:!0,extra:t.jsxs(b,{children:[t.jsxs(M,{value:u,onChange:O,className:"w-32",children:[t.jsx(l,{value:"all",children:"All Time"}),t.jsx(l,{value:"today",children:"Today"}),t.jsx(l,{value:"week",children:"This Week"}),t.jsx(l,{value:"month",children:"This Month"}),t.jsx(l,{value:"custom",children:"Custom Range"})]}),u==="custom"&&t.jsx(V,{value:f,onChange:D,placeholder:["Start Date","End Date"]}),t.jsx(T,{type:"primary",icon:t.jsx(o,{name:"download"}),onClick:()=>{c("transactions"),n(!0)},children:"Export"})]}),emptyDescription:"No orders found",emptyImage:t.jsx(o,{name:"receipt_long",className:"text-6xl text-gray-300"})})}),je=()=>t.jsx(h,{children:t.jsx(P,{title:"Raw Material Reports",icon:"category",columns:me,dataSource:d.filter(e=>e.name.toLowerCase().includes(i.toLowerCase())||e.category.toLowerCase().includes(i.toLowerCase())||e.supplier?.toLowerCase().includes(i.toLowerCase())),rowKey:"id",rowSelection:{type:"checkbox",onChange:e=>C(e)},searchFields:["name","category","supplier"],searchPlaceholder:"Search materials...",showSearch:!0,extra:t.jsx(T,{type:"primary",icon:t.jsx(o,{name:"download"}),onClick:()=>{c("raw-materials"),n(!0)},children:"Export"}),emptyDescription:"No materials found",emptyImage:t.jsx(o,{name:"category",className:"text-6xl text-gray-300"})})}),ge=[{key:"dashboard",label:t.jsxs("span",{className:"flex items-center space-x-2",children:[t.jsx(o,{name:"dashboard"}),t.jsx("span",{children:"Dashboard"})]}),children:he()},{key:"products",label:t.jsxs("span",{className:"flex items-center space-x-2",children:[t.jsx(o,{name:"inventory_2"}),t.jsx("span",{children:"Product Reports"})]}),children:pe()},{key:"orders",label:t.jsxs("span",{className:"flex items-center space-x-2",children:[t.jsx(o,{name:"receipt_long"}),t.jsx("span",{children:"Order Reports"})]}),children:ye()},{key:"materials",label:t.jsxs("span",{className:"flex items-center space-x-2",children:[t.jsx(o,{name:"category"}),t.jsx("span",{children:"Material Reports"})]}),children:je()}];return se?t.jsx(Pe,{type:"table"}):t.jsxs(t.Fragment,{children:[t.jsx(we,{activeKey:ee,onChange:te,items:ge,className:"reports-tabs",size:"large"}),t.jsx(Me,{open:Z,onClose:()=>n(!1),dataType:$,data:{products:j,rawMaterials:d,transactions:w,coupons:H,users:[],auditTrail:[],categories:X}})]})}export{Be as ReportsOverview};
